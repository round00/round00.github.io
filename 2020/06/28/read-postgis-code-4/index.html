<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>PostGIS源码-4-PostGIS导出函数之lwgeom_functions_basic.c - round_0</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="Beginner">





    <meta name="description" content="&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#xFF0C;&amp;#x6765;&amp;#x5B66;&amp;#x4E60;&amp;#x548C;&amp;#x8BB0;&amp;#x5F55;lwgeom_functions_basic.c&amp;#x4E2D;&amp;#x7684;&amp;#x5BFC;&amp;#x51FA;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&amp;#x7531;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;">
<meta property="og:type" content="article">
<meta property="og:title" content="PostGIS源码-4-PostGIS导出函数之lwgeom_functions_basic.c">
<meta property="og:url" content="https://round00.github.io/2020/06/28/read-postgis-code-4/">
<meta property="og:site_name" content="round_0">
<meta property="og:description" content="&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#xFF0C;&amp;#x6765;&amp;#x5B66;&amp;#x4E60;&amp;#x548C;&amp;#x8BB0;&amp;#x5F55;lwgeom_functions_basic.c&amp;#x4E2D;&amp;#x7684;&amp;#x5BFC;&amp;#x51FA;&amp;#x51FD;&amp;#x6570;&amp;#x3002;&amp;#x7531;&amp;#x540D;&amp;#x5B57;&amp;#x53EF;">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-06-28T14:34:34.000Z">
<meta property="article:modified_time" content="2020-07-03T08:24:17.442Z">
<meta property="article:author" content="Jinke Gong">
<meta name="twitter:card" content="summary">





<link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="//fonts.loli.net/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    

    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    <img src="/images/logo.png" alt="" height="32">
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/categories/">Categories</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#1、PostGIS构建-版本-信息">1&nbsp;&nbsp;<b>1、PostGIS构建(版本)信息</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#2、几何对象的基本信息">2&nbsp;&nbsp;<b>2、几何对象的基本信息</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#1-占用空间">2.1&nbsp;&nbsp;1. 占用空间</a>
                    
                    
                    
                    <a class="navbar-item" href="#2-简单总结">2.2&nbsp;&nbsp;2. 简单总结</a>
                    
                    
                    
                    <a class="navbar-item" href="#3-几何对象点的个数">2.3&nbsp;&nbsp;3. 几何对象点的个数</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-几何对象环的个数">2.4&nbsp;&nbsp;4. 几何对象环的个数</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#3、多边形面积">3&nbsp;&nbsp;<b>3、多边形面积</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#4、线串的长度">4&nbsp;&nbsp;<b>4、线串的长度</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#5、多边形周长">4.1&nbsp;&nbsp;5、多边形周长</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#6、几何对象的距离">5&nbsp;&nbsp;<b>6、几何对象的距离</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#7、获取最近的点">6&nbsp;&nbsp;<b>7、获取最近的点</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#8、两对象间的线段">7&nbsp;&nbsp;<b>8、两对象间的线段</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#9、两对象距离阈值">8&nbsp;&nbsp;<b>9、两对象距离阈值</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#10、点是否在圆中">9&nbsp;&nbsp;<b>10、点是否在圆中</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#11、收集几何对象">10&nbsp;&nbsp;<b>11、收集几何对象</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#12、扩大几何对象">11&nbsp;&nbsp;<b>12、扩大几何对象</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#13、几何对象转BOX">12&nbsp;&nbsp;<b>13、几何对象转BOX</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#14、边界框几何对象化">13&nbsp;&nbsp;<b>14、边界框几何对象化</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#15、分割线段">14&nbsp;&nbsp;<b>15、分割线段</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#16、反转顶点">15&nbsp;&nbsp;<b>16、反转顶点</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#17、强制多边形顺时针">16&nbsp;&nbsp;<b>17、强制多边形顺时针</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#18、强制满足SFS标准">17&nbsp;&nbsp;<b>18、强制满足SFS标准</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#19、几何对象的坐标维度">18&nbsp;&nbsp;<b>19、几何对象的坐标维度</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#20、创建点对象">19&nbsp;&nbsp;<b>20、创建点对象</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#21、创建线串对象">20&nbsp;&nbsp;<b>21、创建线串对象</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#22、增删改线串中的点">21&nbsp;&nbsp;<b>22、增删改线串中的点</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#23、计算角度">22&nbsp;&nbsp;<b>23、计算角度</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#24、仿射变换">23&nbsp;&nbsp;<b>24、仿射变换</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#25、经度变换">24&nbsp;&nbsp;<b>25、经度变换</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#26、容器导出指定类型子对象">25&nbsp;&nbsp;<b>26、容器导出指定类型子对象</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/round00" target="_blank" rel="noopener">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            PostGIS源码-4-PostGIS导出函数之lwgeom_functions_basic.c
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-06-28T14:34:34.000Z" itemprop="datePublished">Jun 28 2020</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/PostGIS/">PostGIS</a><span>></span><a class="article-category-link" href="/categories/PostGIS/PostGIS%E6%BA%90%E7%A0%81/">PostGIS源码</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            an hour read (About 6843 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x6765;&#x5B66;&#x4E60;&#x548C;&#x8BB0;&#x5F55;<strong>lwgeom_functions_basic.c</strong>&#x4E2D;&#x7684;&#x5BFC;&#x51FA;&#x51FD;&#x6570;&#x3002;&#x7531;&#x540D;&#x5B57;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x90FD;&#x662F;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x5E95;&#x5C42;&#x7684;&#x57FA;&#x7840;&#x51FD;&#x6570;</p>
<a id="more"></a>

<h3 id="1&#x3001;PostGIS&#x6784;&#x5EFA;-&#x7248;&#x672C;-&#x4FE1;&#x606F;"><a href="#1&#x3001;PostGIS&#x6784;&#x5EFA;-&#x7248;&#x672C;-&#x4FE1;&#x606F;" class="headerlink" title="1&#x3001;PostGIS&#x6784;&#x5EFA;(&#x7248;&#x672C;)&#x4FE1;&#x606F;"></a>1&#x3001;PostGIS&#x6784;&#x5EFA;(&#x7248;&#x672C;)&#x4FE1;&#x606F;</h3><p>&#x8FD9;&#x4E00;&#x8282;&#x662F;&#x5728;PostGIS&#x6784;&#x5EFA;&#x65F6;&#x786E;&#x5B9A;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x5404;&#x79CD;&#x7EC4;&#x4EF6;&#x7684;&#x7248;&#x672C;&#x53F7;&#x3001;&#x65F6;&#x95F4;&#x4E4B;&#x7C7B;&#x7684;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x662F;&#x5728;&#x6784;&#x5EFA;PostGIS&#x7684;&#x65F6;&#x5019;&#x914D;&#x7F6E;&#x597D;&#x540E;&#xFF0C;&#x751F;&#x6210;&#x7684;<strong>postgis_config.h</strong>&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x7136;&#x540E;&#x672C;&#x8282;&#x7684;&#x5404;&#x4E2A;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x628A;&#x8FD9;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#x5185;&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x7EC4;&#x7EC7;&#x6210;&#x4E00;&#x5B9A;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x8FD4;&#x56DE;&#x8F93;&#x51FA;&#x3002;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x51FD;&#x6570;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x62FF;&#x5230;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x7136;&#x540E;&#x62FC;&#x63A5;&#x4E00;&#x4E0B;&#x8FD4;&#x56DE;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4EE5;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4E3E;&#x4F8B;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x53EA;&#x8D34;&#x51FA;&#x58F0;&#x660E;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* postgis_scripts_released() :: text */</span>    </span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_scripts_released</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	<span class="hljs-keyword">char</span> ver[<span class="hljs-number">64</span>];</span><br><span class="line">	<span class="hljs-built_in">text</span> *result;</span><br><span class="line">    <span class="hljs-comment">//&#x628A;&#x7248;&#x672C;&#x53F7;&#x62FC;&#x63A5;&#x8D77;&#x6765;</span></span><br><span class="line">	<span class="hljs-built_in">snprintf</span>(ver, <span class="hljs-number">64</span>, <span class="hljs-string">&quot;%s %s&quot;</span>, POSTGIS_LIB_VERSION, xstr(POSTGIS_REVISION));</span><br><span class="line">	ver[<span class="hljs-number">63</span>] = <span class="hljs-string">&apos;\0&apos;</span>;</span><br><span class="line">    <span class="hljs-comment">//&#x751F;&#x6210;text&#x683C;&#x5F0F;&#x7684;&#x7ED3;&#x679C;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">	result = cstring_to_text(ver);</span><br><span class="line">	PG_RETURN_TEXT_P(result);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5269;&#x4F59;&#x7684;&#x51FD;&#x6570;&#x5982;&#x4E0B;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_version</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_liblwgeom_version</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_lib_version</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_svn_version</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_lib_revision</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_libxml_version</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">postgis_lib_build_date</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x4EE5;&#x4E0A;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#xFF0C;&#x5728;SQL&#x811A;&#x672C;&#x4E2D;&#x7684;&#x58F0;&#x660E;&#xFF0C;&#x548C;C&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<h3 id="2&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;"><a href="#2&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;" class="headerlink" title="2&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;"></a>2&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;</h3><p>&#x8FD9;&#x4E00;&#x8282;&#x7684;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#x3002;&#x4F8B;&#x5982;&#x5360;&#x7528;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#x3001;&#x70B9;&#x6570;&#x3001;&#x73AF;&#x6570;&#x3002;</p>
<h4 id="1-&#x5360;&#x7528;&#x7A7A;&#x95F4;"><a href="#1-&#x5360;&#x7528;&#x7A7A;&#x95F4;" class="headerlink" title="1. &#x5360;&#x7528;&#x7A7A;&#x95F4;"></a>1. &#x5360;&#x7528;&#x7A7A;&#x95F4;</h4><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_MemSize(geometry) :: int4 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_mem_size</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">    GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">    <span class="hljs-comment">//&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x5927;&#x5C0F;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">    <span class="hljs-keyword">size_t</span> <span class="hljs-built_in">size</span> = VARSIZE(geom);</span><br><span class="line">    PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">    PG_RETURN_INT32(<span class="hljs-built_in">size</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="2-&#x7B80;&#x5355;&#x603B;&#x7ED3;"><a href="#2-&#x7B80;&#x5355;&#x603B;&#x7ED3;" class="headerlink" title="2. &#x7B80;&#x5355;&#x603B;&#x7ED3;"></a>2. &#x7B80;&#x5355;&#x603B;&#x7ED3;</h4><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Summary(geometry) ::text */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_summary</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD9;&#x4E2A;&#x662F;&#x628A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7B80;&#x5355;&#x603B;&#x7ED3;&#x4E00;&#x756A;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x3002;&#x8FD9;&#x4E2A;&#x4E00;&#x822C;&#x662F;&#x7528;&#x4E8E;&#x8C03;&#x8BD5;&#x7684;&#xFF0C;&#x8BA9;&#x7528;&#x4E8E;&#x5927;&#x81F4;&#x77E5;&#x9053;&#x8BE5;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<h4 id="3-&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x70B9;&#x7684;&#x4E2A;&#x6570;"><a href="#3-&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x70B9;&#x7684;&#x4E2A;&#x6570;" class="headerlink" title="3. &#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x70B9;&#x7684;&#x4E2A;&#x6570;"></a>3. &#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x70B9;&#x7684;&#x4E2A;&#x6570;</h4><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_NPoints(geometry) :: int4 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_npoints</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">int</span> npoints = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x5305;&#x542B;&#x591A;&#x5C11;&#x4E2A;&#x70B9;</span></span><br><span class="line">	npoints = lwgeom_count_vertices(lwgeom);</span><br><span class="line">	lwgeom_free(lwgeom);</span><br><span class="line"></span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_INT32(npoints);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD9;&#x91CC;&#x8BA1;&#x7B97;&#x70B9;&#x7684;&#x4E2A;&#x6570;&#x7684;&#x89C4;&#x5219;&#x662F;&#xFF1A;&#x8BA1;&#x6570;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x70B9;&#xFF0C;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#xFF0C;&#x8BA1;&#x7B97;&#x5176;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x7684;&#x70B9;&#x7684;&#x6570;&#x76EE;&#x3002;</p>
<h4 id="4-&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x73AF;&#x7684;&#x4E2A;&#x6570;"><a href="#4-&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x73AF;&#x7684;&#x4E2A;&#x6570;" class="headerlink" title="4. &#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x73AF;&#x7684;&#x4E2A;&#x6570;"></a>4. &#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x73AF;&#x7684;&#x4E2A;&#x6570;</h4><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_NRings(geometry) :: int4 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_nrings</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">int</span> nrings = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x73AF;&#x7684;&#x4E2A;&#x6570;</span></span><br><span class="line">	nrings = lwgeom_count_rings(lwgeom);</span><br><span class="line">	lwgeom_free(lwgeom);</span><br><span class="line"></span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_INT32(nrings);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD9;&#x91CC;&#x73AF;&#x7684;&#x8BA1;&#x6570;&#x89C4;&#x5219;&#x662F;&#xFF0C;&#x53EA;&#x5BF9;&#x591A;&#x8FB9;&#x5F62;&#x4E4B;&#x7C7B;&#x7684;&#x56FE;&#x5F62;&#x6709;&#x6548;&#xFF0C;&#x6570;&#x51FA;&#x91CC;&#x9762;&#x7684;&#x73AF;&#x7684;&#x4E2A;&#x6570;&#x3002;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#xFF0C;&#x4F1A;&#x9012;&#x5F52;&#x7684;&#x6570;&#x51FA;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x73AF;&#x6570;&#x3002;</p>
<h3 id="3&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x9762;&#x79EF;"><a href="#3&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x9762;&#x79EF;" class="headerlink" title="3&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x9762;&#x79EF;"></a>3&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x9762;&#x79EF;</h3><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Area2D(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-comment">/* ST_Area(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">ST_Area</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">double</span> area = <span class="hljs-number">0.0</span>;</span><br><span class="line">    <span class="hljs-comment">//&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x8BA1;&#x7B97;&#x9762;&#x63A5;</span></span><br><span class="line">	area = lwgeom_area(lwgeom);</span><br><span class="line"></span><br><span class="line">	lwgeom_free(lwgeom);</span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line"></span><br><span class="line">	PG_RETURN_FLOAT8(area);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x4EE5;&#x666E;&#x901A;&#x591A;&#x8FB9;&#x5F62;&#x4E3A;&#x4F8B;&#xFF0C;&#x770B;&#x4E0B;&#x5982;&#x4F55;&#x8BA1;&#x7B97;&#x9762;&#x79EF;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">lwpoly_area</span><span class="hljs-params">(<span class="hljs-keyword">const</span> LWPOLY *poly)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//.....</span></span><br><span class="line">	<span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>; i &lt; poly-&gt;nrings; i++ )</span><br><span class="line">	{   <span class="hljs-comment">//&#x9700;&#x8981;&#x8BA1;&#x7B97;&#x591A;&#x8FB9;&#x5F62;&#x4E2D;&#x6BCF;&#x4E2A;&#x73AF;&#x7684;&#x9762;&#x79EF;</span></span><br><span class="line">		POINTARRAY *ring = poly-&gt;rings[i];</span><br><span class="line">		<span class="hljs-keyword">double</span> ringarea = <span class="hljs-number">0.0</span>;</span><br><span class="line">        <span class="hljs-comment">//&#x70B9;&#x6570;&#x5C0F;&#x4E8E;3&#x6784;&#x4E0D;&#x6210;&#x73AF;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> ( ring-&gt;npoints &lt; <span class="hljs-number">3</span> )</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">        <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x73AF;&#x7684;&#x9762;&#x79EF;</span></span><br><span class="line">		ringarea = <span class="hljs-built_in">fabs</span>(ptarray_signed_area(ring));</span><br><span class="line">        <span class="hljs-comment">//&#x591A;&#x8FB9;&#x5F62;&#x7684;&#x5185;&#x73AF;&#x662F;&#x591A;&#x8FB9;&#x5F62;&#x7684;&#x6D1E;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x53BB;&#x6389;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> ( i == <span class="hljs-number">0</span> ) <span class="hljs-comment">/* Outer ring, positive area! */</span></span><br><span class="line">			poly_area += ringarea;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-comment">/* Inner ring, negative area! */</span></span><br><span class="line">			poly_area -= ringarea;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> poly_area;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x53EA;&#x6709;&#x591A;&#x8FB9;&#x5F62;&#x624D;&#x6709;&#x9762;&#x79EF;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x70B9;&#x548C;&#x7EBF;&#x4E32;&#x662F;&#x6CA1;&#x6709;&#x9762;&#x79EF;&#x7684;&#x3002;</p>
<h3 id="4&#x3001;&#x7EBF;&#x4E32;&#x7684;&#x957F;&#x5EA6;"><a href="#4&#x3001;&#x7EBF;&#x4E32;&#x7684;&#x957F;&#x5EA6;" class="headerlink" title="4&#x3001;&#x7EBF;&#x4E32;&#x7684;&#x957F;&#x5EA6;"></a>4&#x3001;&#x7EBF;&#x4E32;&#x7684;&#x957F;&#x5EA6;</h3><p>&#x7EBF;&#x4E32;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x5C31;&#x662F;&#x4ECE;&#x8D77;&#x70B9;&#x5230;&#x7EC8;&#x70B9;&#x4E4B;&#x95F4;&#x6BCF;&#x4E2A;&#x7EBF;&#x6BB5;&#x7684;&#x957F;&#x5EA6;&#x4E4B;&#x548C;&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#xFF1A;2D&#x548C;3D&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;2D&#x548C;3D&#x7684;&#x533A;&#x522B;&#xFF0C;&#x4E5F;&#x4EC5;&#x4EC5;&#x662F;&#x5728;&#x8BA1;&#x7B97;&#x4E24;&#x70B9;&#x4E4B;&#x95F4;&#x8DDD;&#x79BB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x591A;&#x4E00;&#x4E2A;Z&#x5750;&#x6807;&#x7684;&#x5E73;&#x65B9;&#x5DEE;&#x800C;&#x5DF2;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Length2d(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-comment">/* ST_Length(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_length2d_linestring</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">double</span> dist = lwgeom_length_2d(lwgeom);</span><br><span class="line">	lwgeom_free(lwgeom);</span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_FLOAT8(dist);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">/* ST_3DLength(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_length_linestring</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">double</span> dist = lwgeom_length(lwgeom);</span><br><span class="line">	lwgeom_free(lwgeom);</span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_FLOAT8(dist);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x4EE5;2D&#x7EBF;&#x4E32;&#x4E3A;&#x4F8B;&#x770B;&#x4E0B;PostGIS&#x662F;&#x5982;&#x4F55;&#x8BA1;&#x7B97;&#x957F;&#x5EA6;&#x7684;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">ptarray_length_2d</span><span class="hljs-params">(<span class="hljs-keyword">const</span> POINTARRAY *pts)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">double</span> dist = <span class="hljs-number">0.0</span>;</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> i;</span><br><span class="line">	<span class="hljs-keyword">const</span> POINT2D *frm;</span><br><span class="line">	<span class="hljs-keyword">const</span> POINT2D *to;</span><br><span class="line">    </span><br><span class="line">	<span class="hljs-keyword">if</span> ( pts-&gt;npoints &lt; <span class="hljs-number">2</span> ) <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;</span><br><span class="line">	frm = getPoint2d_cp(pts, <span class="hljs-number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> ( i=<span class="hljs-number">1</span>; i &lt; pts-&gt;npoints; i++ )</span><br><span class="line">	{   <span class="hljs-comment">//&#x679A;&#x4E3E;&#x6BCF;&#x4E2A;&#x7EBF;&#x6BB5;</span></span><br><span class="line">		to = getPoint2d_cp(pts, i);</span><br><span class="line">        <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x7EBF;&#x6BB5;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x7528;&#x7684;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x719F;&#x77E5;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">		dist += <span class="hljs-built_in">sqrt</span>( ((frm-&gt;x - to-&gt;x)*(frm-&gt;x - to-&gt;x))  +</span><br><span class="line">		              ((frm-&gt;y - to-&gt;y)*(frm-&gt;y - to-&gt;y)) );</span><br><span class="line">        <span class="hljs-comment">//&#x8FED;&#x4EE3;</span></span><br><span class="line">		frm = to;</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">return</span> dist;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x8BA1;&#x7B97;&#x957F;&#x5EA6;&#x53EA;&#x662F;&#x5BF9;&#x7EBF;&#x4E32;&#x4E4B;&#x7C7B;&#x7684;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x6709;&#x7528;&#xFF0C;&#x8BA1;&#x7B97;&#x957F;&#x5EA6;&#x5BF9;&#x591A;&#x8FB9;&#x5F62;&#x662F;&#x65E0;&#x7528;&#x7684;&#x3002;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x4F1A;&#x9012;&#x5F52;&#x7684;&#x8BA1;&#x7B97;&#x51FA;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x7684;&#x957F;&#x5EA6;&#x4E4B;&#x548C;&#x3002;</p>
<h4 id="5&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x5468;&#x957F;"><a href="#5&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x5468;&#x957F;" class="headerlink" title="5&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x5468;&#x957F;"></a>5&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x5468;&#x957F;</h4><p>&#x591A;&#x8FB9;&#x5F62;&#x7684;&#x5468;&#x957F;&#xFF0C;&#x5728;PostGIS&#x4E2D;&#x662F;&#x591A;&#x8FB9;&#x5F62;&#x6240;&#x6709;&#x73AF;&#x7684;&#x957F;&#x5EA6;&#x4E4B;&#x548C;&#x3002;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x4F1A;&#x9012;&#x5F52;&#x7684;&#x8BA1;&#x7B97;&#x5176;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x7684;&#x5468;&#x957F;&#x4E4B;&#x548C;&#x3002;&#x8FD9;&#x91CC;&#x4E5F;&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;2D&#x548C;3D&#x3002;&#x533A;&#x522B;&#x540C;4&#x4E2D;&#x6240;&#x8BF4;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_perimeter2d(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-comment">/* ST_perimeter(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_perimeter2d_poly</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">double</span> perimeter = <span class="hljs-number">0.0</span>;</span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x5468;&#x957F;&#xFF0C;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x6240;&#x6709;&#x73AF;&#x7684;&#x957F;&#x5EA6;&#x4E4B;&#x548C;</span></span><br><span class="line">	perimeter = lwgeom_perimeter_2d(lwgeom);</span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_FLOAT8(perimeter);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">/* ST_3DPerimeter(geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_perimeter_poly</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	GSERIALIZED *geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	LWGEOM *lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	<span class="hljs-keyword">double</span> perimeter = <span class="hljs-number">0.0</span>;</span><br><span class="line"></span><br><span class="line">	perimeter = lwgeom_perimeter(lwgeom);</span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_FLOAT8(perimeter);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="6&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x8DDD;&#x79BB;"><a href="#6&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x8DDD;&#x79BB;" class="headerlink" title="6&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x8DDD;&#x79BB;"></a>6&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x8DDD;&#x79BB;</h3><p>&#x8FD9;&#x91CC;&#x6307;&#x7684;&#x662F;&#x4E24;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x4E2D;&#x6240;&#x5305;&#x542B;&#x7684;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x4E24;&#x4E24;&#x4E4B;&#x95F4;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x8FD9;&#x4E2A;&#x8DDD;&#x79BB;&#x5206;&#x4E3A;&#x6700;&#x5927;&#x6700;&#x5C0F;&#x4E24;&#x79CD;&#x3002;&#x5173;&#x4E8E;&#x4E24;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x8DDD;&#x79BB;&#x662F;&#x600E;&#x4E48;&#x89C4;&#x5B9A;&#x7684;&#xFF0C;&#x662F;&#x5728;<code>lw_dist2d_fast_ptarray_ptarray</code>&#x548C;<code>lw_dist2d_distribute_bruteforce</code>&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p>&#x6700;&#x5927;&#x8DDD;&#x79BB;&#x7684;&#x51FD;&#x6570;&#x5982;&#x4E0B;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* _ST_MaxDistance(geom1 geometry, geom2 geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_maxdistance2d_linestring</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">	<span class="hljs-keyword">double</span> maxdist;</span><br><span class="line">	GSERIALIZED *geom1 = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	GSERIALIZED *geom2 = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">1</span>);</span><br><span class="line">	LWGEOM *lwgeom1 = lwgeom_from_gserialized(geom1);</span><br><span class="line">	LWGEOM *lwgeom2 = lwgeom_from_gserialized(geom2);</span><br><span class="line">    <span class="hljs-comment">//&#x770B;&#x4E24;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x662F;&#x76F8;&#x540C;&#x7684;SRID&#xFF0C;&#x4E0D;&#x662F;&#x7684;&#x8BDD;&#x62A5;&#x9519;</span></span><br><span class="line">	gserialized_error_if_srid_mismatch(geom1, geom2, __func__);</span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x8DDD;&#x79BB;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x8FD8;&#x662F;&#x5728;LWGEOM&#x5E93;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x66F4;&#x591A;&#x7684;&#x504F;&#x5411;&#x4E8E;&#x6570;&#x5B66;</span></span><br><span class="line">	maxdist = lwgeom_maxdistance2d(lwgeom1, lwgeom2);</span><br><span class="line">    <span class="hljs-comment">//&#x6E05;&#x7406;&#x5185;&#x5B58;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x6700;&#x5C0F;&#x8DDD;&#x79BB;&#x7684;&#x51FD;&#x6570;&#x548C;&#x6700;&#x5927;&#x8DDD;&#x79BB;&#x57FA;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* geometry_distance_centroid(geom1 geometry, geom2 geometry) :: FLOAT8*/</span></span><br><span class="line"><span class="hljs-comment">/* ST_Distance(geom1 geometry, geom2 geometry) :: FLOAT8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">ST_Distance</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">double</span> mindist;</span><br><span class="line">	GSERIALIZED *geom1 = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	GSERIALIZED *geom2 = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">1</span>);</span><br><span class="line">	LWGEOM *lwgeom1 = lwgeom_from_gserialized(geom1);</span><br><span class="line">	LWGEOM *lwgeom2 = lwgeom_from_gserialized(geom2);</span><br><span class="line">	gserialized_error_if_srid_mismatch(geom1, geom2, __func__);</span><br><span class="line"></span><br><span class="line">	mindist = lwgeom_mindistance2d(lwgeom1, lwgeom2);</span><br><span class="line">	<span class="hljs-comment">//&#x6E05;&#x7406;&#x5185;&#x5B58;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="7&#x3001;&#x83B7;&#x53D6;&#x6700;&#x8FD1;&#x7684;&#x70B9;"><a href="#7&#x3001;&#x83B7;&#x53D6;&#x6700;&#x8FD1;&#x7684;&#x70B9;" class="headerlink" title="7&#x3001;&#x83B7;&#x53D6;&#x6700;&#x8FD1;&#x7684;&#x70B9;"></a>7&#x3001;&#x83B7;&#x53D6;&#x6700;&#x8FD1;&#x7684;&#x70B9;</h3><p>&#x6307;&#x7684;&#x662F;&#x83B7;&#x53D6;&#x7B2C;&#x4E00;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x79BB;&#x7B2C;&#x4E8C;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x6700;&#x8FD1;&#x7684;&#x70B9;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_ClosestPoint(geom1 geometry, geom2 geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_closestpoint</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x83B7;&#x53D6;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x53C2;&#x6570;</span></span><br><span class="line">	gserialized_error_if_srid_mismatch(geom1, geom2, __func__);</span><br><span class="line">	<span class="hljs-built_in">point</span> = lwgeom_closest_point(lwgeom1, lwgeom2);</span><br><span class="line">	<span class="hljs-comment">//&#x6E05;&#x7406;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="8&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x7EBF;&#x6BB5;"><a href="#8&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x7EBF;&#x6BB5;" class="headerlink" title="8&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x7EBF;&#x6BB5;"></a>8&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x7EBF;&#x6BB5;</h3><p>&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x6700;&#x957F;&#x548C;&#x6700;&#x77ED;&#x7684;&#x7EBF;&#x6BB5;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_ShortestLine(geom1 geometry, geom2 geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_shortestline2d</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-comment">/* _ST_LongestLine(geom1 geometry, geom2 geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_longestline2d</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="9&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x8DDD;&#x79BB;&#x9608;&#x503C;"><a href="#9&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x8DDD;&#x79BB;&#x9608;&#x503C;" class="headerlink" title="9&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x8DDD;&#x79BB;&#x9608;&#x503C;"></a>9&#x3001;&#x4E24;&#x5BF9;&#x8C61;&#x8DDD;&#x79BB;&#x9608;&#x503C;</h3><p>&#x8FD9;&#x7EC4;&#x51FD;&#x6570;&#x7684;&#x610F;&#x601D;&#x662F;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x662F;&#x5426;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x9608;&#x503C;&#x4E4B;&#x5185;&#xFF0C;&#x8FD4;&#x56DE;&#x5E03;&#x5C14;&#x503C;&#x3002;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x8DDD;&#x79BB;&#x5C31;&#x53C8;&#x6709;&#x6700;&#x5927;&#x6700;&#x5C0F;&#x4E4B;&#x8BF4;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x6709;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* _ST_3DDWithin(geom1 geometry, geom2 geometry,float8) :: boolean */</span> </span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_dwithin3d</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-comment">/* _ST_3DDFullyWithin(geom1 geometry, geom2 geometry,float8) :: boolean */</span> </span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_dfullywithin3d</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><strong>&#x6CE8;</strong>&#xFF1A;&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#xFF0C;&#x524D;&#x9762;&#x7684;&#x9664;&#x4E86;&#x7248;&#x672C;&#x53F7;&#x90A3;&#x4E00;&#x5C0F;&#x8282;&#x4E4B;&#x5916;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x90FD;&#x662F;&#x8F6C;&#x800C;&#x8C03;&#x7528;LWGEOM&#x5E93;&#x4E2D;&#x5173;&#x4E8E;&#x6D4B;&#x91CF;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x90FD;&#x662F;&#x5728;<strong>measure.h</strong>&#x548C;<strong>measure.c</strong>&#x4E2D;&#x3002;&#x6211;&#x6253;&#x7B97;&#x4E4B;&#x540E;&#x4E13;&#x95E8;&#x4E5F;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x6765;&#x8BB0;&#x5F55;&#x4E0B;PostGIS&#x4E2D;&#x5173;&#x4E8E;&#x6D4B;&#x91CF;&#x8FD9;&#x90E8;&#x5206;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x524D;&#x9762;&#x90FD;&#x6CA1;&#x6709;&#x8BE6;&#x7EC6;&#x5C55;&#x5F00;&#x8BF4;&#x5E95;&#x5C42;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<h3 id="10&#x3001;&#x70B9;&#x662F;&#x5426;&#x5728;&#x5706;&#x4E2D;"><a href="#10&#x3001;&#x70B9;&#x662F;&#x5426;&#x5728;&#x5706;&#x4E2D;" class="headerlink" title="10&#x3001;&#x70B9;&#x662F;&#x5426;&#x5728;&#x5706;&#x4E2D;"></a>10&#x3001;&#x70B9;&#x662F;&#x5426;&#x5728;&#x5706;&#x4E2D;</h3><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_PointInsideCircle(geometry,float8,float8,float8) :: bool */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_inside_circle_point</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	GSERIALIZED *geom;</span><br><span class="line">    <span class="hljs-comment">//&#x6307;&#x5B9A;&#x5706;&#x7684;&#x53C2;&#x6570;</span></span><br><span class="line">	<span class="hljs-keyword">double</span> cx = PG_GETARG_FLOAT8(<span class="hljs-number">1</span>);</span><br><span class="line">	<span class="hljs-keyword">double</span> cy = PG_GETARG_FLOAT8(<span class="hljs-number">2</span>);</span><br><span class="line">	<span class="hljs-keyword">double</span> rr = PG_GETARG_FLOAT8(<span class="hljs-number">3</span>);</span><br><span class="line">	LWPOINT *lwpoint;</span><br><span class="line">	LWGEOM *lwgeom;</span><br><span class="line">	<span class="hljs-keyword">int</span> inside;</span><br><span class="line">    <span class="hljs-comment">//&#x88AB;&#x5224;&#x65AD;&#x7684;&#x70B9;</span></span><br><span class="line">	geom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	lwpoint = lwgeom_as_lwpoint(lwgeom);</span><br><span class="line">	<span class="hljs-keyword">if</span> (lwpoint == <span class="hljs-literal">NULL</span> || lwgeom_is_empty(lwgeom))</span><br><span class="line">	{</span><br><span class="line">		PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">		PG_RETURN_NULL(); <span class="hljs-comment">/* not a point */</span></span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;point&#x662F;&#x5426;&#x5728;cx,cy,rr&#x6307;&#x5B9A;&#x7684;&#x5706;&#x4E2D;</span></span><br><span class="line">	inside = lwpoint_inside_circle(lwpoint, cx, cy, rr);</span><br><span class="line">	lwpoint_free(lwpoint);</span><br><span class="line"></span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_BOOL(inside);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5224;&#x65AD;&#x70B9;&#x662F;&#x5426;&#x5728;&#x5706;&#x4E2D;&#x7684;&#x539F;&#x7406;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x8BA1;&#x7B97;&#x70B9;&#x548C;&#x5706;&#x5FC3;&#x4E4B;&#x95F4;&#x7684;&#x8DDD;&#x79BB;&#xFF0C;&#x5728;&#x770B;&#x8FD9;&#x4E2A;&#x8DDD;&#x79BB;&#x662F;&#x5426;&#x5C0F;&#x4E8E;&#x534A;&#x5F84;&#x3002;</p>
<h3 id="11&#x3001;&#x6536;&#x96C6;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;"><a href="#11&#x3001;&#x6536;&#x96C6;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;" class="headerlink" title="11&#x3001;&#x6536;&#x96C6;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;"></a>11&#x3001;&#x6536;&#x96C6;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;</h3><p>&#x6536;&#x96C6;&#x662F;&#x6307;&#xFF0C;&#x628A;&#x591A;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x653E;&#x5230;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;&#x5148;&#x770B;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Collect(geom1 geometry, geom2 geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_collect</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	GSERIALIZED *gser1, *gser2, *result;</span><br><span class="line">    <span class="hljs-comment">//&#x76DB;&#x4E24;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x7EC4;</span></span><br><span class="line">	LWGEOM *lwgeoms[<span class="hljs-number">2</span>], *outlwg;</span><br><span class="line">	uint32 type1, type2;</span><br><span class="line">	<span class="hljs-keyword">uint8_t</span> outtype;</span><br><span class="line">	<span class="hljs-keyword">int32_t</span> srid;</span><br><span class="line">    <span class="hljs-comment">//&#x4E00;&#x4E9B;&#x4E3A;&#x7A7A;&#x7684;&#x7279;&#x5224;&#x7701;&#x7565;</span></span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;+&#x5224;&#x7A7A;&#x7701;&#x7565;</span></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">//&#x4FDD;&#x8BC1;&#x7EF4;&#x5EA6;&#x76F8;&#x540C;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((gserialized_has_z(gser1) != gserialized_has_z(gser2)) ||</span><br><span class="line">		(gserialized_has_m(gser1) != gserialized_has_m(gser2)))</span><br><span class="line">	{</span><br><span class="line">		elog(ERROR, <span class="hljs-string">&quot;Cannot ST_Collect geometries with differing dimensionality.&quot;</span>);</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x524D;&#x9762;&#x6709;&#x4FDD;&#x8BC1;SRID&#x76F8;&#x540C;</span></span><br><span class="line">	srid = gserialized_get_srid(gser1);</span><br><span class="line"></span><br><span class="line">	lwgeoms[<span class="hljs-number">0</span>] = lwgeom_from_gserialized(gser1);</span><br><span class="line">	lwgeoms[<span class="hljs-number">1</span>] = lwgeom_from_gserialized(gser2);</span><br><span class="line"></span><br><span class="line">	type1 = lwgeoms[<span class="hljs-number">0</span>]-&gt;type;</span><br><span class="line">	type2 = lwgeoms[<span class="hljs-number">1</span>]-&gt;type;</span><br><span class="line">    <span class="hljs-comment">//&#x7C7B;&#x578B;&#x76F8;&#x540C;&#xFF0C;&#x5E76;&#x4E14;&#x73B0;&#x5728;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x7C7B;&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x521B;&#x5EFA;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x5BB9;&#x5668;&#x5BF9;&#x8C61;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((type1 == type2) &amp;&amp; (!lwgeom_is_collection(lwgeoms[<span class="hljs-number">0</span>])))</span><br><span class="line">		outtype = lwtype_get_collectiontype(type1);</span><br><span class="line">    <span class="hljs-comment">//&#x7C7B;&#x578B;&#x4E0D;&#x540C;&#xFF0C;&#x5C31;&#x7528;&#x901A;&#x7528;&#x5BB9;&#x5668;&#x5BF9;&#x8C61;</span></span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">		outtype = COLLECTIONTYPE;</span><br><span class="line">    <span class="hljs-comment">//&#x4E22;&#x6389;SRID&#x548C;&#x8FB9;&#x754C;&#x6846;&#xFF0C;&#x56E0;&#x4E3A;&#x4E4B;&#x540E;&#x5B83;&#x4EEC;&#x8981;&#x88AB;&#x653E;&#x5230;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x7531;&#x5BB9;&#x5668;&#x6765;&#x6307;&#x5B9A;</span></span><br><span class="line">	lwgeom_drop_bbox(lwgeoms[<span class="hljs-number">0</span>]);</span><br><span class="line">	lwgeom_drop_srid(lwgeoms[<span class="hljs-number">0</span>]);</span><br><span class="line">	lwgeom_drop_bbox(lwgeoms[<span class="hljs-number">1</span>]);</span><br><span class="line">	lwgeom_drop_srid(lwgeoms[<span class="hljs-number">1</span>]);</span><br><span class="line">    <span class="hljs-comment">//&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x628A;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x653E;&#x8FDB;&#x53BB;&#x3002;</span></span><br><span class="line">	outlwg = (LWGEOM *)lwcollection_construct(outtype, srid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">2</span>, lwgeoms);</span><br><span class="line">    <span class="hljs-comment">//&#x6E05;&#x7A7A;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5F88;&#x83DC;&#xFF0C;&#x5B83;&#x53EA;&#x662F;&#x628A;&#x4E24;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x653E;&#x5230;&#x4E00;&#x4E2A;collection&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x628A;&#x4E24;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5B50;&#x5BF9;&#x8C61;&#x90FD;&#x53D6;&#x51FA;&#x6765;&#x518D;&#x653E;&#x5230;&#x65B0;&#x7684;collection&#x4E2D;&#x3002;</p>
<p>&#x6536;&#x96C6;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x662F;&#x7528;&#x6570;&#x7EC4;&#x6765;&#x4F20;&#x4E00;&#x7EC4;&#x5BF9;&#x8C61;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Collect(geometry[]) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_collect_garray</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//Postgres&#x7684;&#x6570;&#x7EC4;&#x7C7B;&#x578B;</span></span><br><span class="line">	ArrayType *<span class="hljs-built_in">array</span>;</span><br><span class="line">	<span class="hljs-keyword">int</span> nelems;</span><br><span class="line">	<span class="hljs-comment">/*GSERIALIZED **geoms; */</span></span><br><span class="line">	GSERIALIZED *result = <span class="hljs-literal">NULL</span>;</span><br><span class="line">	LWGEOM **lwgeoms, *outlwg;</span><br><span class="line">	uint32 outtype;</span><br><span class="line">	<span class="hljs-keyword">int</span> count;</span><br><span class="line">	<span class="hljs-keyword">int32_t</span> srid = SRID_UNKNOWN;</span><br><span class="line">	GBOX *box = <span class="hljs-literal">NULL</span>;</span><br><span class="line">    <span class="hljs-comment">//Postgres&#x7684;&#x6570;&#x7EC4;&#x8FED;&#x4EE3;&#x5668;</span></span><br><span class="line">	ArrayIterator iterator;</span><br><span class="line">	Datum value;</span><br><span class="line">	<span class="hljs-keyword">bool</span> isnull;</span><br><span class="line">    <span class="hljs-comment">//&#x4FDD;&#x8BC1;&#x53C2;&#x6570;&#x975E;&#x7A7A;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (PG_ARGISNULL(<span class="hljs-number">0</span>))</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">    <span class="hljs-comment">//&#x83B7;&#x53D6;&#x6570;&#x7EC4;&#x6570;&#x636E;&#xFF0C;array&#x662F;&#x5305;&#x542B;&#x5934;&#x90E8;&#x7684;&#x6570;&#x7EC4;</span></span><br><span class="line">	<span class="hljs-built_in">array</span> = PG_GETARG_ARRAYTYPE_P(<span class="hljs-number">0</span>);</span><br><span class="line">    <span class="hljs-comment">//&#x5143;&#x7D20;&#x4E2A;&#x6570;</span></span><br><span class="line">	nelems = ArrayGetNItems(ARR_NDIM(<span class="hljs-built_in">array</span>), ARR_DIMS(<span class="hljs-built_in">array</span>));</span><br><span class="line">    <span class="hljs-comment">//&#x6CA1;&#x6709;&#x5143;&#x7D20;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (nelems == <span class="hljs-number">0</span>)</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">    <span class="hljs-comment">//&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x9700;&#x8981;&#x7684;&#x7A7A;&#x95F4;</span></span><br><span class="line">	lwgeoms = palloc(<span class="hljs-keyword">sizeof</span>(LWGEOM *) * nelems);</span><br><span class="line">	count = <span class="hljs-number">0</span>;</span><br><span class="line">	outtype = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">//&#x521B;&#x5EFA;&#x8FED;&#x4EE3;&#x5668;&#xFF0C;&#x6765;&#x904D;&#x5386;&#x6570;&#x7EC4;</span></span><br><span class="line">	iterator = array_create_iterator(<span class="hljs-built_in">array</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">	<span class="hljs-keyword">while</span> (array_iterate(iterator, &amp;value, &amp;isnull))</span><br><span class="line">	{</span><br><span class="line">		GSERIALIZED *geom;</span><br><span class="line">		<span class="hljs-keyword">uint8_t</span> intype;</span><br><span class="line">        <span class="hljs-comment">//&#x7A7A;&#x6570;&#x636E;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (isnull)</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">        <span class="hljs-comment">//&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x4E3A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;</span></span><br><span class="line">		geom = (GSERIALIZED *)DatumGetPointer(value);</span><br><span class="line">		intype = gserialized_get_type(geom);</span><br><span class="line">		lwgeoms[count] = lwgeom_from_gserialized(geom);</span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">if</span> (!count)    <span class="hljs-comment">//&#x7B2C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x8981;&#x4FDD;&#x5B58;&#x4E0B;SRID&#x559D;</span></span><br><span class="line">		{</span><br><span class="line">			<span class="hljs-comment">/* Get first geometry SRID */</span></span><br><span class="line">			srid = lwgeoms[count]-&gt;srid;</span><br><span class="line"></span><br><span class="line">			<span class="hljs-comment">/* COMPUTE_BBOX WHEN_SIMPLE */</span></span><br><span class="line">			<span class="hljs-keyword">if</span> (lwgeoms[count]-&gt;bbox)</span><br><span class="line">				box = gbox_copy(lwgeoms[count]-&gt;bbox);</span><br><span class="line">		}</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">		{</span><br><span class="line">			<span class="hljs-comment">//&#x6240;&#x6709;&#x7684;&#x5B50;&#x5BF9;&#x8C61;&#x8981;&#x4FDD;&#x8BC1;&#x76F8;&#x540C;&#x7684;SRID</span></span><br><span class="line">			gserialized_error_if_srid_mismatch_reference(geom, srid, __func__);</span><br><span class="line">			<span class="hljs-keyword">if</span> (box)</span><br><span class="line">			{   <span class="hljs-comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x6709;&#x8FB9;&#x754C;&#x6846;&#xFF0C;&#x90A3;&#x4E48;&#x5408;&#x5E76;&#x3002;&#x6CA1;&#x6709;&#x5219;&#x90FD;&#x4E0D;&#x8981;&#x8FB9;&#x754C;&#x6846;</span></span><br><span class="line">				<span class="hljs-keyword">if</span> (lwgeoms[count]-&gt;bbox)</span><br><span class="line">					gbox_merge(lwgeoms[count]-&gt;bbox, box);</span><br><span class="line">				<span class="hljs-keyword">else</span></span><br><span class="line">				{</span><br><span class="line">					pfree(box);</span><br><span class="line">					box = <span class="hljs-literal">NULL</span>;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">        <span class="hljs-comment">//&#x4E22;&#x6389;&#x5F53;&#x524D;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;SRID&#x548C;&#x8FB9;&#x754C;&#x6846;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4F1A;&#x6DFB;&#x52A0;</span></span><br><span class="line">		lwgeom_drop_srid(lwgeoms[count]);</span><br><span class="line">		lwgeom_drop_bbox(lwgeoms[count]);</span><br><span class="line">        <span class="hljs-comment">//&#x8F93;&#x51FA;&#x7684;&#x5BB9;&#x5668;&#x7C7B;&#x578B;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (!outtype)</span><br><span class="line">		{</span><br><span class="line">			outtype = lwtype_get_collectiontype(intype);</span><br><span class="line">		}</span><br><span class="line">        <span class="hljs-comment">//&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x7528;collection&#x505A;&#x5BB9;&#x5668;</span></span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (outtype != COLLECTIONTYPE &amp;&amp; lwtype_get_collectiontype(intype) != outtype)</span><br><span class="line">		{</span><br><span class="line">			outtype = COLLECTIONTYPE;</span><br><span class="line">		}</span><br><span class="line">		count++;</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x904D;&#x5386;&#x5B8C;&#x6570;&#x7EC4;&#x4E86;&#xFF0C;&#x6E05;&#x7406;&#x5185;&#x5B58;</span></span><br><span class="line">	array_free_iterator(iterator);</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x975E;&#x6CD5;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (!outtype)</span><br><span class="line">	{</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">else</span>    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x6570;&#x636E;</span></span><br><span class="line">	{</span><br><span class="line">		outlwg = (LWGEOM *)lwcollection_construct(outtype, srid, box, count, lwgeoms);</span><br><span class="line"></span><br><span class="line">		result = geometry_serialize(outlwg);</span><br><span class="line"></span><br><span class="line">		PG_RETURN_POINTER(result);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD9;&#x8FD8;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x89C1;&#x5230;&#x5F80;C&#x8BED;&#x8A00;&#x4E2D;&#x4F20;&#x6570;&#x7EC4;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#x3002;&#x8FD9;&#x4E2A;&#x6536;&#x96C6;&#x7684;&#x539F;&#x7406;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#xFF0C;&#x5C31;&#x662F;&#x628A;&#x6570;&#x7EC4;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x62FF;&#x51FA;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x653E;&#x5230;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>
<h3 id="12&#x3001;&#x6269;&#x5927;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;"><a href="#12&#x3001;&#x6269;&#x5927;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;" class="headerlink" title="12&#x3001;&#x6269;&#x5927;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;"></a>12&#x3001;&#x6269;&#x5927;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;</h3><p>&#x6269;&#x5927;&#x6307;&#x7684;&#x7684;&#x662F;&#xFF0C;&#x628A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x8FB9;&#x754C;&#x6846;&#x6269;&#x5927;&#x6307;&#x5B9A;&#x7684;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x8FB9;&#x754C;&#x6846;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x6269;&#x5927;&#x540E;&#x7684;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Expand(geometry,float8) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_Expand(geom geometry, dx float8, dy float8, </span></span><br><span class="line"><span class="hljs-comment">    dz float8 DEFAULT 0, dm float8 DEFAULT 0) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_expand</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;&#x7701;&#x7565;</span></span><br><span class="line">    <span class="hljs-comment">//&#x6CA1;&#x6709;&#x8FB9;&#x754C;&#x6846;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (LW_FAILURE == lwgeom_calculate_gbox(lwgeom, &amp;gbox))</span><br><span class="line">	{</span><br><span class="line">		lweom_free(lwgeom);</span><br><span class="line">		PG_RETURN_POINTER(geom);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x5224;&#x65AD;&#x662F;&#x54EA;&#x79CD;&#x8C03;&#x7528;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (PG_NARGS() == <span class="hljs-number">2</span>)</span><br><span class="line">	{   <span class="hljs-comment">//&#x6BCF;&#x4E2A;&#x7EF4;&#x5EA6;&#x6269;&#x5927;&#x76F8;&#x540C;&#x7684;&#x91CF;</span></span><br><span class="line">		<span class="hljs-keyword">double</span> d = PG_GETARG_FLOAT8(<span class="hljs-number">1</span>);</span><br><span class="line">		gbox_expand(&amp;gbox, d);</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">	{   <span class="hljs-comment">//&#x5206;&#x522B;&#x6307;&#x5B9A;&#x5404;&#x4E2A;&#x7EF4;&#x5EA6;&#x6269;&#x5927;&#x7684;&#x91CF;</span></span><br><span class="line">		<span class="hljs-keyword">double</span> dx = PG_GETARG_FLOAT8(<span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">double</span> dy = PG_GETARG_FLOAT8(<span class="hljs-number">2</span>);</span><br><span class="line">		<span class="hljs-keyword">double</span> dz = PG_GETARG_FLOAT8(<span class="hljs-number">3</span>);</span><br><span class="line">		<span class="hljs-keyword">double</span> dm = PG_GETARG_FLOAT8(<span class="hljs-number">4</span>);</span><br><span class="line"></span><br><span class="line">		gbox_expand_xyzm(&amp;gbox, dx, dy, dz, dm);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	{   <span class="hljs-comment">//&#x4EE5;&#x8FB9;&#x754C;&#x6846;&#x7684;&#x56DB;&#x4E2A;&#x89D2;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7684;&#x77E9;&#x5F62;</span></span><br><span class="line">		POINT4D p1 = {gbox.xmin, gbox.ymin, gbox.zmin, gbox.mmin};</span><br><span class="line">		POINT4D p2 = {gbox.xmin, gbox.ymax, gbox.zmin, gbox.mmin};</span><br><span class="line">		POINT4D p3 = {gbox.xmax, gbox.ymax, gbox.zmax, gbox.mmax};</span><br><span class="line">		POINT4D p4 = {gbox.xmax, gbox.ymin, gbox.zmax, gbox.mmax};</span><br><span class="line"></span><br><span class="line">		poly = lwpoly_construct_rectangle(lwgeom_has_z(lwgeom), lwgeom_has_m(lwgeom), &amp;p1, &amp;p2, &amp;p3, &amp;p4);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x4E3A;&#x65B0;&#x7684;&#x77E9;&#x5F62;&#x589E;&#x52A0;&#x8FB9;&#x754C;&#x6846;&#x548C;SRID</span></span><br><span class="line">	lwgeom_add_bbox(lwpoly_as_lwgeom(poly));</span><br><span class="line">	lwgeom_set_srid(lwpoly_as_lwgeom(poly), srid);</span><br><span class="line">    <span class="hljs-comment">//&#x6E05;&#x7406;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="13&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x8F6C;BOX"><a href="#13&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x8F6C;BOX" class="headerlink" title="13&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x8F6C;BOX"></a>13&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x8F6C;BOX</h3><p>BOX&#x662F;Postgres&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x662F;&#x7528;&#x4E24;&#x4E2A;&#x70B9;&#x6765;&#x786E;&#x5B9A;&#x4E00;&#x4E2A;BOX&#x3002;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><br><span class="line"><span class="hljs-class">{</span></span><br><span class="line">	Point		high,</span><br><span class="line">				low;			<span class="hljs-comment">/* corner POINTs */</span></span><br><span class="line">} BOX;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD9;&#x91CC;&#x6240;&#x8BF4;&#x7684;&#x8F6C;&#x4E3A;BOX&#xFF0C;&#x662F;&#x6307;&#x5C06;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;GOX&#x8F6C;&#x4E3A;BOX&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* box(geometry) :: box */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_to_BOX</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;</span></span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;&#x8F93;&#x5165;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;GBOX</span></span><br><span class="line">	result = lwgeom_calculate_gbox(lwgeom, &amp;gbox);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//...</span></span><br><span class="line">    <span class="hljs-comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;BOX&#xFF0C;&#x7528;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;GBOX&#x7684;&#x5DE6;&#x4E0B;&#xFF0C;&#x53F3;&#x4E0A;&#x4E24;&#x4E2A;&#x70B9;&#xFF0C;&#x8D4B;&#x7ED9;BOX&#x3002;</span></span><br><span class="line">	out = lwalloc(<span class="hljs-keyword">sizeof</span>(BOX));</span><br><span class="line">	out-&gt;low.x = gbox.xmin;</span><br><span class="line">	out-&gt;low.y = gbox.ymin;</span><br><span class="line">	out-&gt;high.x = gbox.xmax;</span><br><span class="line">	out-&gt;high.y = gbox.ymax;</span><br><span class="line">	PG_RETURN_POINTER(out);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="14&#x3001;&#x8FB9;&#x754C;&#x6846;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x5316;"><a href="#14&#x3001;&#x8FB9;&#x754C;&#x6846;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x5316;" class="headerlink" title="14&#x3001;&#x8FB9;&#x754C;&#x6846;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x5316;"></a>14&#x3001;&#x8FB9;&#x754C;&#x6846;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x5316;</h3><p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6211;&#x5B9E;&#x5728;&#x4E0D;&#x77E5;&#x9053;&#x8BE5;&#x600E;&#x4E48;&#x7FFB;&#x8BD1;&#x4E86;&#xFF0C;&#x51FD;&#x6570;&#x540D;&#x5B57;&#x662F;envelope&#xFF0C;&#x4FE1;&#x5C01;&#x3002;&#x4F46;&#x662F;&#x6211;&#x611F;&#x89C9;&#x4E0D;&#x5230;&#x4EFB;&#x4F55;&#x548C;&#x4FE1;&#x5C01;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x4ECE;&#x5B9E;&#x73B0;&#x4E0A;&#x6765;&#x770B;&#xFF0C;&#x662F;&#x628A;GBOX&#x6309;&#x7167;&#x5927;&#x5C0F;&#xFF0C;&#x8F6C;&#x6362;&#x4E3A;&#x70B9;&#x3001;&#x7EBF;&#x3001;&#x591A;&#x8FB9;&#x5F62;&#x3002;</p>
<p>&#x89C4;&#x5219;&#x662F;&#xFF1A;</p>
<ul>
<li><p>&#x5982;&#x679C;&#x8FB9;&#x754C;&#x6846;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x5373;&#x5DE6;&#x4E0B;&#x548C;&#x53F3;&#x4E0A;&#x91CD;&#x5408;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8F93;&#x51FA;&#x4E00;&#x4E2A;&#x70B9;</p>
</li>
<li><p>&#x5982;&#x679C;&#x8FB9;&#x754C;&#x6846;&#x662F;&#x4E00;&#x6761;&#x7EBF;&#x6BB5;&#xFF0C;&#x90A3;&#x4E48;&#x8F93;&#x51FA;&#x7EBF;&#x4E32;</p>
</li>
<li><p>&#x5426;&#x5219;&#x8F93;&#x51FA;&#x591A;&#x8FB9;&#x5F62;&#x3002;</p>
</li>
</ul>
<p>&#x53EA;&#x5BF9;2D&#x6709;&#x6548;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Envelope(geometry) :: geometry*/</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_envelope</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	<span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;...</span></span><br><span class="line">    <span class="hljs-comment">//&#x8BA1;&#x7B97;gbox</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (lwgeom_calculate_gbox(lwgeom, &amp;box) == LW_FAILURE)</span><br><span class="line">	{</span><br><span class="line">		PG_RETURN_POINTER(geom);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x5DE6;&#x4E0B;&#x548C;&#x53F3;&#x4E0A;&#x91CD;&#x5408;&#xFF0C;&#x8FD4;&#x56DE;&#x70B9;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((box.xmin == box.xmax) &amp;&amp; (box.ymin == box.ymax))</span><br><span class="line">	{</span><br><span class="line">        <span class="hljs-comment">//&#x521B;&#x5EFA;&#x70B9;</span></span><br><span class="line">		LWPOINT *<span class="hljs-built_in">point</span> = lwpoint_make2d(srid, box.xmin, box.ymin);</span><br><span class="line">		result = geometry_serialize(lwpoint_as_lwgeom(<span class="hljs-built_in">point</span>));</span><br><span class="line">		lwpoint_free(<span class="hljs-built_in">point</span>);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x662F;&#x4E00;&#x6761;&#x6C34;&#x5E73;&#x6216;&#x5782;&#x76F4;&#x7684;&#x76F4;&#x7EBF;</span></span><br><span class="line">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((box.xmin == box.xmax) || (box.ymin == box.ymax))</span><br><span class="line">	{</span><br><span class="line">		LWLINE *<span class="hljs-built_in">line</span>;</span><br><span class="line">        <span class="hljs-comment">//&#x6709;&#x4E24;&#x4E2A;&#x70B9;&#x7684;&#x7EBF;&#x4E32;</span></span><br><span class="line">		pa = ptarray_construct_empty(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);</span><br><span class="line">        <span class="hljs-comment">//&#x628A;&#x4E24;&#x4E2A;&#x70B9;&#x52A0;&#x5165;&#x7EBF;&#x4E32;&#x4E2D;</span></span><br><span class="line">		pt.x = box.xmin;</span><br><span class="line">		pt.y = box.ymin;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line">		pt.x = box.xmax;</span><br><span class="line">		pt.y = box.ymax;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line">        <span class="hljs-comment">//&#x6784;&#x9020;&#x4E00;&#x6761;&#x76F4;&#x7EBF;</span></span><br><span class="line">		<span class="hljs-built_in">line</span> = lwline_construct(srid, <span class="hljs-literal">NULL</span>, pa);</span><br><span class="line">		result = geometry_serialize(lwline_as_lwgeom(<span class="hljs-built_in">line</span>));</span><br><span class="line">		lwline_free(<span class="hljs-built_in">line</span>);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x5269;&#x4E0B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5C31;&#x662F;&#x591A;&#x8FB9;&#x5F62;&#x4E86;</span></span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">	{   <span class="hljs-comment">//&#x591A;&#x8FB9;&#x5F62;&#xFF0C;&#x662F;&#x7531;&#x8FB9;&#x754C;&#x6846;&#x7684;4&#x4E2A;&#x70B9;&#x6784;&#x6210;&#x7684;&#x4E00;&#x4E2A;&#x95ED;&#x5408;&#x7EBF;&#x4E32;</span></span><br><span class="line">        <span class="hljs-comment">//&#x8981;&#x95ED;&#x5408;&#xFF0C;&#x8D77;&#x70B9;&#x5C31;&#x5F97;&#x7528;&#x4E24;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x662F;5&#x4E2A;&#x70B9;</span></span><br><span class="line">		LWPOLY *poly;</span><br><span class="line">		POINTARRAY **ppa = lwalloc(<span class="hljs-keyword">sizeof</span>(POINTARRAY *));</span><br><span class="line">		pa = ptarray_construct_empty(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>);</span><br><span class="line">		ppa[<span class="hljs-number">0</span>] = pa;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">/* Assign coordinates to POINT2D array */</span></span><br><span class="line">		pt.x = box.xmin;</span><br><span class="line">		pt.y = box.ymin;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line">		pt.x = box.xmin;</span><br><span class="line">		pt.y = box.ymax;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line">		pt.x = box.xmax;</span><br><span class="line">		pt.y = box.ymax;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line">		pt.x = box.xmax;</span><br><span class="line">		pt.y = box.ymin;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line">		pt.x = box.xmin;</span><br><span class="line">		pt.y = box.ymin;</span><br><span class="line">		ptarray_append_point(pa, &amp;pt, LW_TRUE);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//&#x6784;&#x9020;&#x591A;&#x8FB9;&#x5F62;&#xFF0C;1&#x662F;&#x6307;1&#x4E2A;&#x73AF;</span></span><br><span class="line">		poly = lwpoly_construct(srid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, ppa);</span><br><span class="line">		result = geometry_serialize(lwpoly_as_lwgeom(poly));</span><br><span class="line">		lwpoly_free(poly);</span><br><span class="line">	}</span><br><span class="line">	PG_FREE_IF_COPY(geom, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_POINTER(result);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="15&#x3001;&#x5206;&#x5272;&#x7EBF;&#x6BB5;"><a href="#15&#x3001;&#x5206;&#x5272;&#x7EBF;&#x6BB5;" class="headerlink" title="15&#x3001;&#x5206;&#x5272;&#x7EBF;&#x6BB5;"></a>15&#x3001;&#x5206;&#x5272;&#x7EBF;&#x6BB5;</h3><p>&#x5206;&#x6BB5;&#x662F;&#x6307;&#x5728;&#x7ED9;&#x5B9A;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x628A;&#x957F;&#x4E8E;&#x6307;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x7EBF;&#x6BB5;&#xFF0C;&#x5206;&#x5272;&#x6210;&#x591A;&#x4E2A;&#x8F83;&#x77ED;&#x7684;&#x7EBF;&#x6BB5;&#x3002;&#x5206;&#x5272;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x7EBF;&#x6BB5;&#x4E2D;&#x95F4;&#x6DFB;&#x52A0;&#x70B9;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x7EBF;&#x4E32;&#x6765;&#x8BF4;&#xFF0C;&#x76F4;&#x63A5;&#x5206;&#x5272;&#x6BCF;&#x4E2A;&#x7EBF;&#x6BB5;&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x8FB9;&#x5F62;&#x6765;&#x8BF4;&#xFF0C;&#x5206;&#x5272;&#x6BCF;&#x4E2A;&#x73AF;&#xFF0C;&#x6BCF;&#x4E2A;&#x73AF;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7EBF;&#x4E32;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Segmentize(geometry, float8) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_segmentize2d</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x53C2;&#x6570;&#x5B9A;&#x4E49;....</span></span><br><span class="line">	ingeom = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	dist = PG_GETARG_FLOAT8(<span class="hljs-number">1</span>);</span><br><span class="line">	type = gserialized_get_type(ingeom);</span><br><span class="line">    <span class="hljs-comment">//&#x4E0D;&#x652F;&#x6301;&#x5206;&#x5272;&#x7684;&#x7C7B;&#x578B;    </span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((type == POINTTYPE) || (type == MULTIPOINTTYPE) || (type == TRIANGLETYPE) || (type == TINTYPE) ||</span><br><span class="line">	    (type == POLYHEDRALSURFACETYPE))</span><br><span class="line">	{</span><br><span class="line">		PG_RETURN_POINTER(ingeom);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//.....</span></span><br><span class="line">    <span class="hljs-comment">//&#x8FD9;&#x4E2A;&#x76EE;&#x524D;&#x641E;&#x4E0D;&#x592A;&#x6E05;&#x695A;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x3002;&#x597D;&#x50CF;&#x662F;&#x5728;win32&#x4E0A;&#xFF0C;&#x5206;&#x53D1;&#x6392;&#x961F;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x4E0D;&#x61C2;&#x3002;    </span></span><br><span class="line">	LWGEOM_INIT();</span><br><span class="line">    <span class="hljs-comment">//&#x53CD;&#x5E8F;&#x5217;&#x5316;</span></span><br><span class="line">	inlwgeom = lwgeom_from_gserialized(ingeom);</span><br><span class="line">	<span class="hljs-keyword">if</span> (lwgeom_is_empty(inlwgeom))</span><br><span class="line">	{</span><br><span class="line">		<span class="hljs-comment">/* Should only happen on interruption */</span></span><br><span class="line">		lwgeom_free(inlwgeom);</span><br><span class="line">		PG_RETURN_POINTER(ingeom);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8C03;&#x7528;&#x63A5;&#x53E3;&#xFF0C;&#x8FDB;&#x884C;&#x5206;&#x6BB5;</span></span><br><span class="line">	outlwgeom = lwgeom_segmentize2d(inlwgeom, dist);</span><br><span class="line">	<span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="16&#x3001;&#x53CD;&#x8F6C;&#x9876;&#x70B9;"><a href="#16&#x3001;&#x53CD;&#x8F6C;&#x9876;&#x70B9;" class="headerlink" title="16&#x3001;&#x53CD;&#x8F6C;&#x9876;&#x70B9;"></a>16&#x3001;&#x53CD;&#x8F6C;&#x9876;&#x70B9;</h3><p>&#x53CD;&#x8F6C;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7EBF;&#x4E32;&#x4E2D;&#x7684;&#x70B9;&#xFF0C;&#x4F8B;&#x5982;&#x628A;&#x4E00;&#x4E2A;&#x7EBF;&#x4E32;&#x7684;&#x524D;&#x9762;&#x548C;&#x540E;&#x9762;&#x7684;&#x70B9;&#x4EA4;&#x6362;&#x4F4D;&#x7F6E;&#x3002;</p>
<ul>
<li><p>&#x5BF9;&#x4E8E;&#x70B9;&#x7C7B;&#x578B;&#x7684;&#x6CA1;&#x4F5C;&#x7528;&#x3002;</p>
</li>
<li><p>&#x7EBF;&#x4E32;&#x7C7B;&#x578B;&#x76F4;&#x63A5;&#x53CD;&#x8F6C;</p>
</li>
<li><p>&#x591A;&#x8FB9;&#x5F62;&#x53CD;&#x8F6C;&#x6BCF;&#x4E2A;&#x73AF;</p>
</li>
<li><p>&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x9012;&#x5F52;&#x53CD;&#x8F6C;&#x6BCF;&#x4E2A;&#x5B50;&#x7C7B;&#x578B;</p>
</li>
</ul>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4EE5;&#x53CD;&#x8F6C;&#x7EBF;&#x4E32;&#x4E3A;&#x4F8B;&#x770B;&#x4E0B;&#x5B9E;&#x73B0;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Reverse(geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_reverse</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;</span></span><br><span class="line">	lwgeom_reverse_in_place(lwgeom);</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ptarray_reverse_in_place</span><span class="hljs-params">(POINTARRAY *pa)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">if</span> (!pa-&gt;npoints)</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> i;</span><br><span class="line">    <span class="hljs-comment">//&#x7528;&#x8FD9;&#x4E24;&#x4E2A;+&#x8FED;&#x4EE3;i&#x5C31;&#x53EF;&#x4EE5;&#x904D;&#x5386;&#x4EA4;&#x6362;&#x6240;&#x6709;&#x7684;&#x70B9;</span></span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> last = pa-&gt;npoints - <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> mid = pa-&gt;npoints / <span class="hljs-number">2</span>;</span><br><span class="line">    <span class="hljs-comment">//d&#x662F;&#x70B9;&#x6570;&#x636E;&#x7684;&#x8D77;&#x70B9;</span></span><br><span class="line">	<span class="hljs-keyword">double</span> *d = (<span class="hljs-keyword">double</span>*)(pa-&gt;serialized_pointlist);</span><br><span class="line">	<span class="hljs-keyword">int</span> j;</span><br><span class="line">	<span class="hljs-keyword">int</span> ndims = FLAGS_NDIMS(pa-&gt;flags);</span><br><span class="line">    <span class="hljs-comment">//&#x904D;&#x5386;mid&#x524D;&#x9762;&#x7684;&#x70B9;&#xFF0C;last-i&#x5C31;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#x540E;&#x9762;&#x7684;&#x70B9;</span></span><br><span class="line">	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; mid; i++)</span><br><span class="line">	{   <span class="hljs-comment">//&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x7EF4;&#x5EA6;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x7528;&#x628A;&#x6BCF;&#x4E2A;&#x7EF4;&#x5EA6;&#x90FD;&#x624B;&#x5199;&#x4E00;&#x6B21;&#x4E86;</span></span><br><span class="line">		<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; ndims; j++)</span><br><span class="line">		{</span><br><span class="line">            <span class="hljs-comment">//&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x8BED;&#x53E5;&#x5C31;&#x662F;&#xFF1A;swap(d[i*ndims+j], d[(last-i)*ndims+j]);</span></span><br><span class="line">            <span class="hljs-comment">//&#x4EA4;&#x6362;&#x4E24;&#x4E2A;&#x70B9;&#x7684;&#x67D0;&#x4E2A;&#x5750;&#x6807;</span></span><br><span class="line">			<span class="hljs-keyword">double</span> buf;</span><br><span class="line">			buf = d[i*ndims+j];</span><br><span class="line">			d[i*ndims+j] = d[(last-i)*ndims+j];</span><br><span class="line">			d[(last-i)*ndims+j] = buf;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">return</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="17&#x3001;&#x5F3A;&#x5236;&#x591A;&#x8FB9;&#x5F62;&#x987A;&#x65F6;&#x9488;"><a href="#17&#x3001;&#x5F3A;&#x5236;&#x591A;&#x8FB9;&#x5F62;&#x987A;&#x65F6;&#x9488;" class="headerlink" title="17&#x3001;&#x5F3A;&#x5236;&#x591A;&#x8FB9;&#x5F62;&#x987A;&#x65F6;&#x9488;"></a>17&#x3001;&#x5F3A;&#x5236;&#x591A;&#x8FB9;&#x5F62;&#x987A;&#x65F6;&#x9488;</h3><p>&#x6539;&#x53D8;&#x591A;&#x8FB9;&#x5F62;&#xFF0C;&#x4FDD;&#x8BC1;&#x5916;&#x73AF;&#x987A;&#x65F6;&#x9488;&#xFF0C;&#x5185;&#x73AF;&#x9006;&#x65F6;&#x9488;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x7B26;&#x5408;&#x5219;&#x53CD;&#x8F6C;&#x73AF;&#xFF0C;&#x53CD;&#x8F6C;&#x662F;&#x4E0A;&#x4E00;&#x8282;&#x8BF4;&#x7684;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x5947;&#x6DEB;&#x6280;&#x5DE7;&#xFF0C;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x73AF;&#x662F;&#x987A;&#x65F6;&#x9488;&#x8FD8;&#x662F;&#x9006;&#x65F6;&#x9488;&#x3002;&#x6709;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#x53EB;&#xFF1A; <strong>Shoelace formula</strong>&#xFF0C;&#x7528;&#x5B83;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x51FA;&#x5E26;&#x7B26;&#x53F7;&#x7684;&#x591A;&#x8FB9;&#x5F62;&#x7684;&#x9762;&#x79EF;&#x3002;&#x5982;&#x679C;&#x9762;&#x79EF;&#x662F;&#x6B63;&#x7684;&#x5219;&#x8868;&#x793A;&#x987A;&#x65F6;&#x9488;&#xFF0C;&#x4E3A;&#x8D1F;&#x5219;&#x662F;&#x9006;&#x65F6;&#x9488;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_ForcePolygonCW(geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_ForceRHR(geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_force_clockwise_poly</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	<span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;....</span></span><br><span class="line">	lwgeom_force_clockwise(lwgeom);</span><br><span class="line">	outgeom = geometry_serialize(lwgeom);</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;....</span></span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x5F3A;&#x5236;&#x4F7F;&#x591A;&#x8FB9;&#x5F62;&#x7B26;&#x5408;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x89C4;&#x5219;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lwpoly_force_clockwise</span><span class="hljs-params">(LWPOLY *poly)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">/* No-op empties */</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ( lwpoly_is_empty(poly) )</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//&#x5916;&#x73AF;&#x8981;&#x4FDD;&#x8BC1;&#x987A;&#x65F6;&#x9488;&#x3002;&#x5982;&#x679C;&#x662F;&#x9006;&#x65F6;&#x9488;&#xFF0C;&#x5219;&#x7FFB;&#x8F6C;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ( ptarray_isccw(poly-&gt;rings[<span class="hljs-number">0</span>]) )</span><br><span class="line">		ptarray_reverse_in_place(poly-&gt;rings[<span class="hljs-number">0</span>]);</span><br><span class="line">    <span class="hljs-comment">//&#x5185;&#x73AF;&#x8981;&#x4FDD;&#x8BC1;&#x9006;&#x65F6;&#x9488;&#x3002;&#x5982;&#x679C;&#x662F;&#x987A;&#x65F6;&#x9488;&#xFF0C;&#x5219;&#x7FFB;&#x8F6C;</span></span><br><span class="line">	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">1</span>; i&lt;poly-&gt;nrings; i++)</span><br><span class="line">		<span class="hljs-keyword">if</span> ( ! ptarray_isccw(poly-&gt;rings[i]) )</span><br><span class="line">			ptarray_reverse_in_place(poly-&gt;rings[i]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="18&#x3001;&#x5F3A;&#x5236;&#x6EE1;&#x8DB3;SFS&#x6807;&#x51C6;"><a href="#18&#x3001;&#x5F3A;&#x5236;&#x6EE1;&#x8DB3;SFS&#x6807;&#x51C6;" class="headerlink" title="18&#x3001;&#x5F3A;&#x5236;&#x6EE1;&#x8DB3;SFS&#x6807;&#x51C6;"></a>18&#x3001;&#x5F3A;&#x5236;&#x6EE1;&#x8DB3;SFS&#x6807;&#x51C6;</h3><p>SFS&#x6807;&#x51C6;&#x89C4;&#x5B9A;&#x4E86;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x3002;&#x6211;&#x770B;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x5DEE;&#x4E0D;&#x591A;&#x5C31;&#x662F;&#x5C06;&#x66F2;&#x7EBF;&#x51E0;&#x4F55;&#x7EBF;&#x6027;&#x5316;&#x3002;&#x5177;&#x4F53;&#x7EBF;&#x6027;&#x5316;&#x7684;&#x89C4;&#x5219;&#x6BD4;&#x8F83;&#x504F;&#x6570;&#x5B66;&#xFF0C;&#x6CA1;&#x6709;&#x7EC6;&#x770B;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_ForceSFS(geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_ForceSFS(geometry, version text) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_force_sfs</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//.....</span></span><br><span class="line">    <span class="hljs-comment">//&#x9ED8;&#x8BA4;sfs&#x7248;&#x672C;&#x662F;1.1</span></span><br><span class="line">	<span class="hljs-keyword">int</span> version = <span class="hljs-number">110</span>; <span class="hljs-comment">/* default version is SFS 1.1 */</span></span><br><span class="line">    <span class="hljs-comment">//&#x6307;&#x5B9A;&#x4E86;&#x7248;&#x672C;&#x53C2;&#x6570;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((PG_NARGS() &gt; <span class="hljs-number">1</span>) &amp;&amp; (!PG_ARGISNULL(<span class="hljs-number">1</span>)))</span><br><span class="line">	{</span><br><span class="line">		ver = PG_GETARG_TEXT_P(<span class="hljs-number">1</span>);</span><br><span class="line">        <span class="hljs-comment">//&#x6307;&#x5B9A;sfs&#x7248;&#x672C;1.2&#x3002;&#x5C31;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#xFF1F;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strncmp</span>(VARDATA(ver), <span class="hljs-string">&quot;1.2&quot;</span>, <span class="hljs-number">3</span>))</span><br><span class="line">		{</span><br><span class="line">			version = <span class="hljs-number">120</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//SFS&#x6807;&#x51C6;&#x5316;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x66F2;&#x7EBF;&#x51E0;&#x4F55;&#x7EBF;&#x6027;&#x5316;</span></span><br><span class="line">	lwgeom = lwgeom_from_gserialized(geom);</span><br><span class="line">	ogeom = lwgeom_force_sfs(lwgeom, version);</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;....</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="19&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x5750;&#x6807;&#x7EF4;&#x5EA6;"><a href="#19&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x5750;&#x6807;&#x7EF4;&#x5EA6;" class="headerlink" title="19&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x5750;&#x6807;&#x7EF4;&#x5EA6;"></a>19&#x3001;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x5750;&#x6807;&#x7EF4;&#x5EA6;</h3><p>&#x6709;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x548C;&#x8FD9;&#x4E00;&#x8282;&#x76F8;&#x5173;&#x7684;&#xFF0C;&#x628A;&#x5B83;&#x4EEC;&#x90FD;&#x5217;&#x51FA;&#x6765;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_zmflag(geometry) :: smallint */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_zmflag</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-comment">/* ST_NDims(geometry) :: smallint */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_ndims</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-comment">//&#x8FD9;&#x4E24;&#x4E2A;&#x6CA1;&#x6709;&#x5BFC;&#x51FA;&#x63A5;&#x53E3;</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_hasz</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_hasm</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x7B2C;&#x4E8C;&#x4E2A;&#x51FD;&#x6570;&#x662F;&#x8FD4;&#x56DE;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x7684;&#x7EF4;&#x5EA6;&#xFF0C;&#x4EE5;2&#x3001;3&#x3001;4&#x8868;&#x793A;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;z&#x3001;m&#x7EF4;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//&#x8FD4;&#x56DE;&#x503C;&#xFF1A;0==2d;1==3dm;2==3dz;3==4d</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_zmflag</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	GSERIALIZED *in = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">0</span>);</span><br><span class="line">	<span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (gserialized_has_z(in))</span><br><span class="line">		ret += <span class="hljs-number">2</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (gserialized_has_m(in))</span><br><span class="line">		ret += <span class="hljs-number">1</span>;</span><br><span class="line">	PG_FREE_IF_COPY(in, <span class="hljs-number">0</span>);</span><br><span class="line">	PG_RETURN_INT16(ret);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="20&#x3001;&#x521B;&#x5EFA;&#x70B9;&#x5BF9;&#x8C61;"><a href="#20&#x3001;&#x521B;&#x5EFA;&#x70B9;&#x5BF9;&#x8C61;" class="headerlink" title="20&#x3001;&#x521B;&#x5EFA;&#x70B9;&#x5BF9;&#x8C61;"></a>20&#x3001;&#x521B;&#x5EFA;&#x70B9;&#x5BF9;&#x8C61;</h3><p>&#x5B57;&#x9762;&#x610F;&#x601D;&#xFF0C;&#x5C31;&#x662F;&#x6839;&#x636E;&#x6307;&#x5B9A;&#x5750;&#x6807;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x70B9;&#x8FD4;&#x56DE;&#x3002;&#x56E0;&#x4E3A;&#x7EF4;&#x5EA6;&#x4E0D;&#x540C;&#xFF0C;&#x6240;&#x6709;&#x5F88;&#x591A;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_MakePoint(float8, float8) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_MakePoint(float8, float8, float8) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_MakePoint(float8, float8, float8, float8) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_Point(float8, float8) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_makepoint</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x53C2;&#x6570;&#x5B9A;&#x4E49;....</span></span><br><span class="line">	x = PG_GETARG_FLOAT8(<span class="hljs-number">0</span>);</span><br><span class="line">	y = PG_GETARG_FLOAT8(<span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-comment">//2D   </span></span><br><span class="line">	<span class="hljs-keyword">if</span> (PG_NARGS() == <span class="hljs-number">2</span>)</span><br><span class="line">		<span class="hljs-built_in">point</span> = lwpoint_make2d(SRID_UNKNOWN, x,     y);</span><br><span class="line">	<span class="hljs-comment">//3DZ</span></span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (PG_NARGS()== <span class="hljs-number">3</span>)</span><br><span class="line">	{</span><br><span class="line">		z = PG_GETARG_FLOAT8(<span class="hljs-number">2</span>);</span><br><span class="line">		<span class="hljs-built_in">point</span> = lwpoint_make3dz(SRID_UNKNOWN, x, y, z);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//4D</span></span><br><span class="line">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (PG_NARGS() == <span class="hljs-number">4</span>)</span><br><span class="line">	{</span><br><span class="line">		z = PG_GETARG_FLOAT8(<span class="hljs-number">2</span>);</span><br><span class="line">		m = PG_GETARG_FLOAT8(<span class="hljs-number">3</span>);</span><br><span class="line">		<span class="hljs-built_in">point</span> = lwpoint_make4d(SRID_UNKNOWN, x, y, z, m);</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">else</span>    <span class="hljs-comment">//&#x8C03;&#x7528;&#x53C2;&#x6570;&#x9519;&#x8BEF;</span></span><br><span class="line">	{</span><br><span class="line">		elog(ERROR, <span class="hljs-string">&quot;LWGEOM_makepoint: unsupported number of args: %d&quot;</span>, PG_NARGS());</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	result = geometry_serialize((LWGEOM *)<span class="hljs-built_in">point</span>);</span><br><span class="line"></span><br><span class="line">	PG_RETURN_POINTER(result);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">/* ST_MakePointM(float8, float8, float8) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_makepoint3dm</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="21&#x3001;&#x521B;&#x5EFA;&#x7EBF;&#x4E32;&#x5BF9;&#x8C61;"><a href="#21&#x3001;&#x521B;&#x5EFA;&#x7EBF;&#x4E32;&#x5BF9;&#x8C61;" class="headerlink" title="21&#x3001;&#x521B;&#x5EFA;&#x7EBF;&#x4E32;&#x5BF9;&#x8C61;"></a>21&#x3001;&#x521B;&#x5EFA;&#x7EBF;&#x4E32;&#x5BF9;&#x8C61;</h3><p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x4E32;&#xFF0C;&#x6839;&#x636E;&#x53C2;&#x6570;&#x4E0D;&#x540C;&#x6709;&#x8F83;&#x591A;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;&#x70B9;&#x6570;&#x7EC4;&#x3001;&#x4E24;&#x4E2A;&#x70B9;&#x3001;&#x591A;&#x70B9;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;&#x3002;&#x6211;&#x4EEC;&#x4EE5;&#x591A;&#x70B9;&#x4E3A;&#x4F8B;&#x770B;&#x4E0B;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4ED6;&#x4E24;&#x4E2A;&#x7ED9;&#x51FA;&#x58F0;&#x660E;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_MakeLine (geometry[]) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_makeline_garray</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-comment">/* ST_MakeLine (geom1 geometry, geom2 geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_makeline</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/* ST_LineFromMultiPoint(geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_line_from_mpoint</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">	<span class="hljs-comment">//&#x8F93;&#x5165;&#x53C2;&#x6570;</span></span><br><span class="line">	lwline = lwline_from_lwmpoint(mpoint-&gt;srid, mpoint);</span><br><span class="line">	<span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span></span><br><span class="line">}</span><br><span class="line"><span class="hljs-function">LWLINE *<span class="hljs-title">lwline_from_lwmpoint</span><span class="hljs-params">(<span class="hljs-keyword">int32_t</span> srid, <span class="hljs-keyword">const</span> LWMPOINT *mpoint)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> i;</span><br><span class="line">	POINTARRAY *pa = <span class="hljs-literal">NULL</span>;</span><br><span class="line">	LWGEOM *lwgeom = (LWGEOM*)mpoint;</span><br><span class="line">	POINT4D pt;</span><br><span class="line">    <span class="hljs-comment">//&#x7EF4;&#x5EA6;&#x4FE1;&#x606F;</span></span><br><span class="line">	<span class="hljs-keyword">char</span> hasz = lwgeom_has_z(lwgeom);</span><br><span class="line">	<span class="hljs-keyword">char</span> hasm = lwgeom_has_m(lwgeom);</span><br><span class="line">    <span class="hljs-comment">//&#x70B9;&#x6570;</span></span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> npoints = mpoint-&gt;ngeoms;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> ( lwgeom_is_empty(lwgeom) )</span><br><span class="line">	{</span><br><span class="line">		<span class="hljs-keyword">return</span> lwline_construct_empty(srid, hasz, hasm);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;&#x70B9;&#x6570;&#x7EC4;</span></span><br><span class="line">	pa = ptarray_construct(hasz, hasm, npoints);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; npoints; i++)</span><br><span class="line">	{   <span class="hljs-comment">//&#x83B7;&#x53D6;&#x7B2C;i&#x4E2A;&#x70B9;</span></span><br><span class="line">		getPoint4d_p(mpoint-&gt;geoms[i]-&gt;<span class="hljs-built_in">point</span>, <span class="hljs-number">0</span>, &amp;pt);</span><br><span class="line">        <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x70B9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x7B2C;i&#x4E2A;&#x70B9;</span></span><br><span class="line">		ptarray_set_point4d(pa, i, &amp;pt);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	LWDEBUGF(<span class="hljs-number">3</span>, <span class="hljs-string">&quot;lwline_from_lwmpoint: constructed pointarray for %d points&quot;</span>, mpoint-&gt;ngeoms);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> lwline_construct(srid, <span class="hljs-literal">NULL</span>, pa);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="22&#x3001;&#x589E;&#x5220;&#x6539;&#x7EBF;&#x4E32;&#x4E2D;&#x7684;&#x70B9;"><a href="#22&#x3001;&#x589E;&#x5220;&#x6539;&#x7EBF;&#x4E32;&#x4E2D;&#x7684;&#x70B9;" class="headerlink" title="22&#x3001;&#x589E;&#x5220;&#x6539;&#x7EBF;&#x4E32;&#x4E2D;&#x7684;&#x70B9;"></a>22&#x3001;&#x589E;&#x5220;&#x6539;&#x7EBF;&#x4E32;&#x4E2D;&#x7684;&#x70B9;</h3><p>&#x8FD9;&#x8282;&#x6709;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x3001;&#x4FEE;&#x6539;&#x7EBF;&#x4E32;&#x4E2D;&#x7684;&#x70B9;&#x3002;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x8C03;&#x7528;LWGEOM&#x5E93;&#x4E2D;&#x589E;&#x5220;&#x6539;&#x7EBF;&#x4E32;&#x70B9;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x4EE5;&#x4FEE;&#x6539;&#x4E3A;&#x4F8B;&#x6765;&#x770B;&#xFF0C;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x53EA;&#x8D34;&#x51FA;&#x58F0;&#x660E;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x7EBF;&#x4E32;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x70B9;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;&#x662F;&#x6DFB;&#x52A0;&#x70B9;&#x7684;&#x4F4D;&#x7F6E;</span></span><br><span class="line"><span class="hljs-comment">/* ST_AddPoint(geom1 geometry, geom2 geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-comment">/* ST_AddPoint(geom1 geometry, geom2 geometry, integer) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_addpoint</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"><span class="hljs-comment">//&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x7EBF;&#x4E32;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x8981;&#x5220;&#x9664;&#x7B2C;&#x51E0;&#x4E2A;&#x70B9;</span></span><br><span class="line"><span class="hljs-comment">/* ST_RemovePoint(geometry, integer) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_removepoint</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/* ST_SetPoint(geometry, integer, geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_setpoint_linestring</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x5B9A;&#x4E49;&#x53C2;&#x6570;...</span></span><br><span class="line">    <span class="hljs-comment">//PostgreSQL&#x7684;&#x5EFA;&#x8BAE;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x4FEE;&#x6539;&#x4F20;&#x8FC7;&#x6765;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x8BDD;&#xFF0C;&#x8981;&#x628A;&#x5B83;&#x62F7;&#x8D1D;&#x4E00;&#x4EFD;</span></span><br><span class="line">    <span class="hljs-comment">//&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x7684;&#x8BDD;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x5E93;&#x78C1;&#x76D8;&#x4E0A;&#x7684;&#x5185;&#x5BB9;&#x3002;</span></span><br><span class="line">    <span class="hljs-comment">//&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x7EBF;&#x4E32;</span></span><br><span class="line">	pglwg1 = PG_GETARG_GSERIALIZED_P_COPY(<span class="hljs-number">0</span>);</span><br><span class="line">    <span class="hljs-comment">//&#x7B2C;&#x51E0;&#x4E2A;&#x70B9;</span></span><br><span class="line">	which = PG_GETARG_INT32(<span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-comment">//&#x8981;&#x4FEE;&#x6539;&#x6210;&#x7684;&#x70B9;&#x5BF9;&#x8C61;</span></span><br><span class="line">	pglwg2 = PG_GETARG_GSERIALIZED_P(<span class="hljs-number">2</span>);</span><br><span class="line">    <span class="hljs-comment">//&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5F97;&#x5230;&#x65B0;&#x70B9;&#xFF0C;&#x548C;&#x7EBF;&#x4E32;...</span></span><br><span class="line">    <span class="hljs-comment">//&#x8FD9;&#x91CC;&#x6709;bug&#x554A;&#xFF0C;&#x5982;&#x679C;which&#x5F88;&#x5C0F;&#x5C31;&#x8981;&#x6302;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (which &lt; <span class="hljs-number">0</span>)</span><br><span class="line">	{</span><br><span class="line">        <span class="hljs-comment">//&#x5982;&#x679C;which&#x5C0F;&#x4E8E;0&#xFF0C;&#x5C31;&#x53CD;&#x5411;&#x7D22;&#x5F15;&#xFF0C;&#x7C7B;&#x4F3C;python</span></span><br><span class="line">		which += (<span class="hljs-keyword">int64_t</span>)<span class="hljs-built_in">line</span>-&gt;points-&gt;npoints;</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8D85;&#x51FA;&#x70B9;&#x6570;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((<span class="hljs-keyword">uint32_t</span>)which &gt; <span class="hljs-built_in">line</span>-&gt;points-&gt;npoints - <span class="hljs-number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		elog(ERROR, <span class="hljs-string">&quot;abs(Point index) out of range (-)(%u..%u)&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">line</span>-&gt;points-&gt;npoints - <span class="hljs-number">1</span>);</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8C03;&#x7528;LWGEOM&#x5E93;&#x63A5;&#x53E3;</span></span><br><span class="line">	lwline_setPoint4d(<span class="hljs-built_in">line</span>, (<span class="hljs-keyword">uint32_t</span>)which, &amp;newpoint);</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x63A5;&#x53E3;....</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="23&#x3001;&#x8BA1;&#x7B97;&#x89D2;&#x5EA6;"><a href="#23&#x3001;&#x8BA1;&#x7B97;&#x89D2;&#x5EA6;" class="headerlink" title="23&#x3001;&#x8BA1;&#x7B97;&#x89D2;&#x5EA6;"></a>23&#x3001;&#x8BA1;&#x7B97;&#x89D2;&#x5EA6;</h3><p>&#x8FD9;&#x91CC;&#x7684;&#x89D2;&#x5EA6;&#x8BA1;&#x7B97;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF0C;&#x4E00;&#x662F;&#x7531;&#x4E24;&#x4E2A;&#x70B9;&#x786E;&#x5B9A;&#x7684;&#x7EBF;&#x6BB5;&#x7684;<strong>&#x65B9;&#x4F4D;&#x89D2;</strong>&#xFF0C;&#x53E6;&#x4E00;&#x662F;&#x7531;&#x4E09;&#x4E2A;&#x70B9;&#x786E;&#x5B9A;&#x7684;&#x89D2;&#x5EA6;&#x6216;&#x8005;&#x7531;&#x4E24;&#x4E2A;&#x5411;&#x91CF;&#xFF08;&#x56DB;&#x4E2A;&#x70B9;&#xFF09;&#x786E;&#x5B9A;&#x7684;&#x89D2;&#x5EA6;&#x3002;&#x6211;&#x4EEC;&#x7ED9;&#x51FA;&#x65B9;&#x4F4D;&#x89D2;&#x8BA1;&#x7B97;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8BA1;&#x7B97;&#x89D2;&#x5EA6;&#x7684;&#x4EE3;&#x7801;&#x4E5F;&#x662F;&#x5229;&#x7528;&#x65B9;&#x4F4D;&#x89D2;&#x6765;&#x7B97;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x8D34;&#x51FA;&#x58F0;&#x660E;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//&#x53C2;&#x6570;&#x662F;&#x4E24;&#x4E2A;&#x70B9;</span></span><br><span class="line"><span class="hljs-comment">/* ST_azimuth(geom1 geometry, geom2 geometry) :: float8 */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_azimuth</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x4E24;&#x4E2A;&#x70B9;</span></span><br><span class="line">    <span class="hljs-comment">//&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x70B9;&#x76F8;&#x7B49;&#xFF0C;&#x5219;&#x65E0;&#x6CD5;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD4;&#x56DE;NULL</span></span><br><span class="line">	<span class="hljs-keyword">if</span> ((p1.x == p2.x) &amp;&amp; (p1.y == p2.y))</span><br><span class="line">	{</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x8BA1;&#x7B97;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (!azimuth_pt_pt(&amp;p1, &amp;p2, &amp;result))</span><br><span class="line">	{</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	PG_RETURN_FLOAT8(result);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x8BA1;&#x7B97;&#x65B9;&#x4F4D;&#x89D2;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x6570;&#x5B66;&#x516C;&#x5F0F;&#x53EF;&#x4EE5;&#x641C;&#x7D22;&#x4E00;&#x4E0B;&#x3002;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">azimuth_pt_pt</span><span class="hljs-params">(<span class="hljs-keyword">const</span> POINT2D *A, <span class="hljs-keyword">const</span> POINT2D *B, <span class="hljs-keyword">double</span> *d)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">if</span> (A-&gt;x == B-&gt;x &amp;&amp; A-&gt;y == B-&gt;y)</span><br><span class="line">		<span class="hljs-keyword">return</span> LW_FALSE;</span><br><span class="line">	*d = <span class="hljs-built_in">fmod</span>(<span class="hljs-number">2</span> * M_PI + M_PI / <span class="hljs-number">2</span> - <span class="hljs-built_in">atan2</span>(B-&gt;y - A-&gt;y, B-&gt;x - A-&gt;x), <span class="hljs-number">2</span> * M_PI);</span><br><span class="line">	<span class="hljs-keyword">return</span> LW_TRUE;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Angle(pt1 geometry, pt2 geometry, pt3 geometry, </span></span><br><span class="line"><span class="hljs-comment">&#xA0;&#xA0;&#xA0;&#xA0;pt4 geometry default &apos;POINT EMPTY&apos;::geometry) :: float8*/</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_angle</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="24&#x3001;&#x4EFF;&#x5C04;&#x53D8;&#x6362;"><a href="#24&#x3001;&#x4EFF;&#x5C04;&#x53D8;&#x6362;" class="headerlink" title="24&#x3001;&#x4EFF;&#x5C04;&#x53D8;&#x6362;"></a>24&#x3001;&#x4EFF;&#x5C04;&#x53D8;&#x6362;</h3><p><strong>&#x4EFF;&#x5C04;&#x53D8;&#x6362;</strong>&#x6307;&#x7684;&#x662F;&#xFF1A;&#x5728;&#x51E0;&#x4F55;&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x5411;&#x91CF;&#x7A7A;&#x95F4;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x7EBF;&#x6027;&#x53D8;&#x6362;&#xFF0C;&#x53D8;&#x6362;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;&#x5411;&#x91CF;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x5728;&#x7F51;&#x4E0A;&#x641C;&#x5230;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x6570;&#x5B66;&#x64CD;&#x4F5C;&#x6211;&#x4E5F;&#x4E0D;&#x61C2;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_Affine(geometry,float8,float8,float8,float8,float8,</span></span><br><span class="line"><span class="hljs-comment">    float8,float8,float8,float8,float8,float8,float8) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_affine</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;-&#x8981;&#x8FDB;&#x884C;&#x53D8;&#x6362;&#x7684;&#x51E0;&#x4F55;&#x5BF9;&#x8C61;</span></span><br><span class="line">    <span class="hljs-comment">//&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x662F;PostGIS&#x5B9A;&#x4E49;&#x7684;&#x4EFF;&#x5C04;&#x53D8;&#x6362;&#x7684;&#x7ED3;&#x6784;&#x4F53;</span></span><br><span class="line">	AFFINE affine;</span><br><span class="line">	affine.afac = PG_GETARG_FLOAT8(<span class="hljs-number">1</span>);</span><br><span class="line">	affine.bfac = PG_GETARG_FLOAT8(<span class="hljs-number">2</span>);</span><br><span class="line">	<span class="hljs-comment">//.....</span></span><br><span class="line">	affine.zoff = PG_GETARG_FLOAT8(<span class="hljs-number">12</span>);</span><br><span class="line">    <span class="hljs-comment">//&#x4EFF;&#x5C04;&#x53D8;&#x6362;&#x63A5;&#x53E3;&#xFF0C;&#x4E0B;&#x9762;&#x8D34;&#x51FA;&#x70B9;&#x6570;&#x7EC4;&#x8FDB;&#x884C;&#x4EFF;&#x5C04;&#x53D8;&#x6362;&#x7684;&#x5B9E;&#x73B0;</span></span><br><span class="line">	lwgeom_affine(lwgeom, &amp;affine);</span><br><span class="line">    <span class="hljs-comment">//&#x66F4;&#x65B0;&#x8FB9;&#x754C;&#x6846;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (lwgeom-&gt;bbox)</span><br><span class="line">	{</span><br><span class="line">		lwgeom_refresh_bbox(lwgeom);</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span></span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x70B9;&#x6570;&#x7EC4;&#x7684;&#x4EFF;&#x5C04;&#x53D8;&#x6362;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ptarray_affine</span><span class="hljs-params">(POINTARRAY *pa, <span class="hljs-keyword">const</span> AFFINE *a)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">if</span> ( FLAGS_GET_Z(pa-&gt;flags) ){</span><br><span class="line">		<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;pa-&gt;npoints; i++){</span><br><span class="line">			getPoint4d_p(pa, i, &amp;p4d);</span><br><span class="line">			x = p4d.x;</span><br><span class="line">			y = p4d.y;</span><br><span class="line">			z = p4d.z;</span><br><span class="line">			p4d.x = a-&gt;afac * x + a-&gt;bfac * y + a-&gt;cfac * z + a-&gt;xoff;</span><br><span class="line">			p4d.y = a-&gt;dfac * x + a-&gt;efac * y + a-&gt;ffac * z + a-&gt;yoff;</span><br><span class="line">			p4d.z = a-&gt;gfac * x + a-&gt;hfac * y + a-&gt;ifac * z + a-&gt;zoff;</span><br><span class="line">			ptarray_set_point4d(pa, i, &amp;p4d);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">else</span>{</span><br><span class="line">		<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;pa-&gt;npoints; i++){</span><br><span class="line">			getPoint4d_p(pa, i, &amp;p4d);</span><br><span class="line">			x = p4d.x;</span><br><span class="line">			y = p4d.y;</span><br><span class="line">			p4d.x = a-&gt;afac * x + a-&gt;bfac * y + a-&gt;xoff;</span><br><span class="line">			p4d.y = a-&gt;dfac * x + a-&gt;efac * y + a-&gt;yoff;</span><br><span class="line">			ptarray_set_point4d(pa, i, &amp;p4d);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="25&#x3001;&#x7ECF;&#x5EA6;&#x53D8;&#x6362;"><a href="#25&#x3001;&#x7ECF;&#x5EA6;&#x53D8;&#x6362;" class="headerlink" title="25&#x3001;&#x7ECF;&#x5EA6;&#x53D8;&#x6362;"></a>25&#x3001;&#x7ECF;&#x5EA6;&#x53D8;&#x6362;</h3><p>&#x7ECF;&#x5EA6;&#x53D8;&#x6362;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x7ECF;&#x5EA6;&#x5E73;&#x79FB;&#xFF0C;&#x6307;Y&#x5750;&#x6807;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF0C;X&#x5750;&#x6807;&#x4ECE;[-180, 180]&#x53D8;&#x4E3A;[0, 360]&#x3002;&#x6216;&#x8005;&#x4ECE;[0, 360]&#x53D8;&#x4E3A;[-180, 180]&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_ShiftLongitude(geometry) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">LWGEOM_longitude_shift</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;...</span></span><br><span class="line">    <span class="hljs-comment">//&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x7ECF;&#x5EA6;&#x7684;&#x53D8;&#x6362;</span></span><br><span class="line">	lwgeom_longitude_shift(lwgeom);</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ptarray_longitude_shift</span><span class="hljs-params">(POINTARRAY *pa)</span></span>{</span><br><span class="line">	<span class="hljs-keyword">uint32_t</span> i;</span><br><span class="line">	<span class="hljs-keyword">double</span> x;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;pa-&gt;npoints; i++){</span><br><span class="line">        <span class="hljs-comment">//&#x83B7;&#x53D6;&#x7B2C;i&#x4E2A;&#x70B9;&#x7684;X&#x5750;&#x6807;</span></span><br><span class="line">		<span class="hljs-built_in">memcpy</span>(&amp;x, getPoint_internal(pa, i), <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">double</span>));</span><br><span class="line">        <span class="hljs-comment">//&#x8FD9;&#x91CC;&#x6211;&#x89C9;&#x5F97;&#x592A;&#x6709;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x96BE;&#x9053;&#x4E0D;&#x8BE5;&#x662F;+-180&#x5EA6;&#x4E48;&#xFF1F;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> ( x &lt; <span class="hljs-number">0</span> ) x+= <span class="hljs-number">360</span>;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( x &gt; <span class="hljs-number">180</span> ) x -= <span class="hljs-number">360</span>;</span><br><span class="line">		<span class="hljs-built_in">memcpy</span>(getPoint_internal(pa, i), &amp;x, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">double</span>));</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="26&#x3001;&#x5BB9;&#x5668;&#x5BFC;&#x51FA;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5B50;&#x5BF9;&#x8C61;"><a href="#26&#x3001;&#x5BB9;&#x5668;&#x5BFC;&#x51FA;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5B50;&#x5BF9;&#x8C61;" class="headerlink" title="26&#x3001;&#x5BB9;&#x5668;&#x5BFC;&#x51FA;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5B50;&#x5BF9;&#x8C61;"></a>26&#x3001;&#x5BB9;&#x5668;&#x5BFC;&#x51FA;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5B50;&#x5BF9;&#x8C61;</h3><p>&#x9012;&#x5F52;&#x7684;&#x5BFC;&#x51FA;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x548C;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#x7684;&#x5B50;&#x5BF9;&#x8C61;&#x3002;</p>
<p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* ST_CollectionExtract(geometry, integer) :: geometry */</span></span><br><span class="line"><span class="hljs-function">Datum <span class="hljs-title">ST_CollectionExtract</span><span class="hljs-params">(PG_FUNCTION_ARGS)</span></span>{</span><br><span class="line">    <span class="hljs-comment">//&#x8BFB;&#x53D6;&#x53C2;&#x6570;...</span></span><br><span class="line">    <span class="hljs-comment">//&#x53EA;&#x80FD;&#x53EA;&#x80FD;&#x5BFC;&#x51FA;&#x4E00;&#x4E0B;&#x51E0;&#x79CD;&#x7C7B;&#x578B;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (!(type == POINTTYPE || type == LINETYPE || type == POLYGONTYPE))</span><br><span class="line">	{</span><br><span class="line">		lwgeom_free(lwgeom);</span><br><span class="line">		elog(ERROR, <span class="hljs-string">&quot;ST_CollectionExtract: only point, linestring and polygon may be extracted&quot;</span>);</span><br><span class="line">		PG_RETURN_NULL();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//&#x975E;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5C31;&#x884C;</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (!lwgeom_is_collection(lwgeom))</span><br><span class="line">	{   <span class="hljs-comment">//&#x5982;&#x679C;&#x662F;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (lwgeom_type == type)</span><br><span class="line">		{</span><br><span class="line">			lwgeom_free(lwgeom);</span><br><span class="line">			PG_RETURN_POINTER(input);</span><br><span class="line">		}</span><br><span class="line">        <span class="hljs-comment">//&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7A7A;&#x5BF9;&#x8C61;</span></span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">		{</span><br><span class="line">			lwcol = lwgeom_construct_empty(</span><br><span class="line">			    type, lwgeom-&gt;srid, lwgeom_has_z(lwgeom), lwgeom_has_m(lwgeom));</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">	{   <span class="hljs-comment">//&#x9012;&#x5F52;&#x7684;&#x5BFC;&#x51FA;&#x5BB9;&#x5668;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;</span></span><br><span class="line">		lwcol = lwcollection_as_lwgeom(lwcollection_extract((LWCOLLECTION *)lwgeom, type));</span><br><span class="line">	}</span><br><span class="line">    <span class="hljs-comment">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5269;&#x4E0B;&#x8FD8;&#x6709;&#x51E0;&#x4E2A;&#x51FD;&#x6570;&#x5927;&#x90FD;&#x662F;&#x8C03;&#x7528;LWGEOM&#x5E93;&#x7684;&#xFF0C;&#x5C31;&#x4E0D;&#x8D34;&#x4E86;&#x3002;&#x672C;&#x7BC7;&#x4E5F;&#x5230;&#x8FD9;&#x5C31;&#x5B8C;&#x4E86;&#x3002;</p>
</body></html>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop is-hidden-mobile article-nav-prev">
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2020/06/25/read-postgis-code-3/">PostGIS源码-3-PostGIS导出函数之lwgeom_ogc.c</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<div id="valine-thread"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#valine-thread',
        appId: 'FgIQVv5B2kd1MwbTL9glqpQf-gzGzoHsz',
        appKey: 'r47AH79b8Oiqd2FTHu7lWE1A',
        notify: false,
        verify: false,
        avatar: '',
        placeholder: 'Welcome to leave a comment',
        meta: ['nick', 'mail'],
        visitor: true,
        lang: ''
    })
</script>


</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 Jinke Gong&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/round00" target="_blank" rel="noopener">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>